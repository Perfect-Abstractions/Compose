---
sidebar_position: 510
title: "ExampleDiamond"
description: "Example Diamond with constructor, fallback, and receive functions"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/example/ExampleDiamond.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Example Diamond with constructor, fallback, and receive functions
</DocSubtitle>

<Callout type="info" title="Key Features">
- Initializes the diamond contract with facets and owner.
- Supports adding, replacing, or removing facets during initialization.
- Includes `fallback` and `receive` functions for general contract interaction and ether reception.
</Callout>

## Overview

The ExampleDiamond contract serves as a foundational template for Compose diamonds. It demonstrates the diamond proxy pattern's initialization via a constructor, enabling the addition of facets and setting the diamond's owner. It also includes fallback and receive functions to handle arbitrary calls and ether transfers, respectively.

---

## Storage

## Functions

### constructor

Struct to hold facet address and its function selectors. struct FacetCut &#123; address facetAddress; FacetCutAction action; // Add=0, Replace=1, Remove=2 bytes4[] functionSelectors; &#125; Initializes the diamond contract with facets, owner and other data. Adds all provided facets to the diamond's function selector mapping and sets the contract owner. Each facet in the array will have its function selectors registered to enable delegatecall routing.

<ExpandableCode language="solidity" maxLines={8}>
{`constructor(DiamondMod.FacetCut[] memory _facets, address _diamondOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_facets",
      type: "DiamondMod.FacetCut[]",
      description: "Array of facet addresses and their corresponding function selectors to add to the diamond."
    },
    {
      name: "_diamondOwner",
      type: "address",
      description: "Address that will be set as the owner of the diamond contract."
    }
  ]}
  showRequired={false}
/>

---
### fallback

<ExpandableCode language="solidity" maxLines={8}>
{`fallback() external payable;`}
</ExpandableCode>

---
### receive

<ExpandableCode language="solidity" maxLines={8}>
{`receive() external payable;`}
</ExpandableCode>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {ExampleDiamond} from "@compose/diamond/example/ExampleDiamond";
import {DiamondMod} from "@compose/diamond/DiamondMod";

contract DeployExampleDiamond {
    address public diamondAddress;

    function deploy() public {
        // Define facets to be added during deployment
        DiamondMod.FacetCut[] memory facets = new DiamondMod.FacetCut[](1);
        // Assuming MyFacet is a deployed facet contract
        // address myFacetAddress = address(new MyFacet());
        // facets[0] = DiamondMod.FacetCut(myFacetAddress, DiamondMod.FacetCutAction.Add, MyFacet.selectors());

        // For this example, we'll simulate a constructor call without actual facets
        // In a real scenario, you would pass actual facet data.
        address owner = msg.sender;
        ExampleDiamond exampleDiamond = new ExampleDiamond();
        // The actual constructor call would look like this:
        // ExampleDiamond exampleDiamond = new ExampleDiamond(facets, owner);

        diamondAddress = address(exampleDiamond);
    }

    // To interact with the deployed diamond, you would typically use an instance of
    // the diamond contract and call functions on it.
    // function interactWithDiamond() public {
    //     ExampleDiamond deployedDiamond = ExampleDiamond(diamondAddress);
    //     // Call functions on facets added to the diamond
    //     // deployedDiamond.myFacetFunction();
    // }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the diamond with all necessary facets and the owner address using the constructor during deployment.
- Ensure that the `functionSelectors` array within `FacetCut` accurately reflects the functions exposed by each facet address.
- The `ExampleDiamond` contract itself is a deployment template; production diamonds will typically inherit from or utilize `DiamondMod` for facet management.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The constructor function is critical for initial setup. Ensure that the provided facet addresses are trustworthy and that the function selectors accurately map to the intended functions. The `fallback` and `receive` functions are payable and can be called externally, so any logic within them must be robust against reentrancy if state changes are involved (though none are defined in this example).
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "ExampleDiamond",
        href: "/docs/library/diamond/example/ExampleDiamond",
        description: "Module used by ExampleDiamond",
        icon: "ðŸ“¦"
      },
      {
        title: "DiamondInspectFacet",
        href: "/docs/library/diamond/DiamondInspectFacet",
        description: "Related facet in diamond",
        icon: "ðŸ’Ž"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ExampleDiamond" />
</div>

<LastUpdated date="2025-12-30T15:39:38.099Z" />
