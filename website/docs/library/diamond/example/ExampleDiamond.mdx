---
sidebar_position: 99
title: "ExampleDiamond"
description: "Diamond proxy for routing external calls to facets"
gitSource: "https://github.com/maxnorm/Compose/blob/2dfa9eb69851162421010a7e56bd0fa891a9311a/src/diamond/example/ExampleDiamond.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Diamond proxy for routing external calls to facets
</DocSubtitle>

<Callout type="info" title="Key Features">
- Centralized function routing via delegatecall.
- Supports modularity by allowing dynamic addition/removal of functionality (facets).
- Enables upgradeability by replacing facet implementations without changing the diamond proxy address.
</Callout>

## Overview

The ExampleDiamond acts as a central proxy, managing function routing to various facets. It initializes the diamond by mapping function selectors to their corresponding facet addresses, enabling modular and upgradeable smart contract logic.

---

## Storage

## Functions

### constructor

Struct to hold facet address and its function selectors. struct FacetCut &#123; address facetAddress; FacetCutAction action; // Add=0, Replace=1, Remove=2 bytes4[] functionSelectors; &#125; Initializes the diamond contract with facets, owner and other data. Adds all provided facets to the diamond's function selector mapping and sets the contract owner. Each facet in the array will have its function selectors registered to enable delegatecall routing.

<ExpandableCode language="solidity" maxLines={8}>
{`constructor(DiamondMod.FacetCut[] memory _facets, address _diamondOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_facets",
      type: "DiamondMod.FacetCut[]",
      description: "Array of facet addresses and their corresponding function selectors to add to the diamond."
    },
    {
      name: "_diamondOwner",
      type: "address",
      description: "Address that will be set as the owner of the diamond contract."
    }
  ]}
  showRequired={false}
/>

---
### fallback

<ExpandableCode language="solidity" maxLines={8}>
{`fallback() external payable;`}
</ExpandableCode>

---
### receive

<ExpandableCode language="solidity" maxLines={8}>
{`receive() external payable;`}
</ExpandableCode>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IDiamondCut} from "@compose/diamond/contracts/IDiamondCut.sol";
import {IDiamondLoupe} from "@compose/diamond/contracts/IDiamondLoupe.sol";

// Assume ExampleDiamond is deployed and initialized
contract Consumer {
    IDiamondCut internal immutable diamondCut;
    IDiamondLoupe internal immutable diamondLoupe;

    constructor(address _diamondAddress) {
        diamondCut = IDiamondCut(_diamondAddress);
        diamondLoupe = IDiamondLoupe(_diamondAddress);
    }

    function addFacet(address _facetAddress, bytes4[] memory _selectors) external {
        // Call the diamond's cut function to add a new facet
        // Requires owner permissions on the diamond
        diamondCut.diamondCut([IDiamondCut.FacetCut({
            facetAddress: _facetAddress,
            action: IDiamondCut.FacetCutAction.Add,
            functionSelectors: _selectors
        })], address(0), "");
    }

    function getFacetAddress(bytes4 _selector) external view returns (address) {
        return diamondLoupe.facetAddress(_selector);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the diamond with owner and initial facets during deployment.
- Use the `diamondCut` interface for adding, replacing, or removing facets.
- Grant necessary permissions to the entity responsible for managing facet additions/removals.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure that only authorized addresses can call `diamondCut` to prevent unauthorized facet manipulation. Input validation for facet addresses and selectors is crucial. Be mindful of state coupling between facets that might share storage slots.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ExampleDiamond" />
</div>

<LastUpdated date="2025-12-21T21:45:29.249Z" />
