---
sidebar_position: 510
title: "DiamondInspectFacet"
description: "Inspect diamond storage and function mappings."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspect diamond storage and function mappings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides read-only access to diamond's function-to-facet mappings.
- Enables programmatic inspection of the diamond's storage layout.
- Utilizes inline assembly for direct storage access, ensuring efficiency for critical inspection tasks.
</Callout>

## Overview

The DiamondInspectFacet provides read-only access to the diamond's internal state and function routing. It allows external querying of how function selectors map to specific facet addresses, facilitating dynamic interaction and debugging without altering diamond state.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.diamond\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of `FunctionFacetPair` structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {DiamondInspectFacet} from "@compose/diamond/DiamondInspectFacet";
import {IDiamondCut} from "@compose/diamond/IDiamondCut";

contract Deployer {
    address immutable diamond;

    constructor(address _diamond) {
        diamond = _diamond;
    }

    function inspectDiamond() external view {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamond);

        // Get all function selector to facet address mappings
        DiamondInspectFacet.FunctionFacetPair[] memory pairs = inspectFacet.functionFacetPairs();

        // Example: Iterate and log mappings (requires a logging mechanism or event)
        for (uint i = 0; i < pairs.length; i++) {
            // Log pairs[i].functionSelector and pairs[i].facetAddress
            // (Actual logging would involve events or external calls)
        }
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Integrate this facet to enable external inspection of diamond's function routing.
- Use the `functionFacetPairs` function to dynamically resolve function calls when the target facet is not known statically.
- Access storage directly via `getStorage` only when absolutely necessary for deep inspection, as it bypasses standard function call interfaces.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet is read-only and does not introduce reentrancy risks. Direct storage access via `getStorage` should be used with caution to avoid misinterpreting raw storage data. Ensure that the diamond's storage slot `DIAMOND_STORAGE_POSITION` is correctly set to `keccak256("compose.diamond")` to prevent accidental data corruption.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-30T15:56:01.960Z" />
