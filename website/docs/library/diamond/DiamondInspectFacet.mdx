---
sidebar_position: 510
title: "DiamondInspectFacet"
description: "Inspect diamond storage and function mappings."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspect diamond storage and function mappings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides direct access to the diamond's storage slot.
- Maps function selectors to their respective facet addresses.
- Read-only operations, ensuring no unintended state changes.
</Callout>

## Overview

The DiamondInspectFacet provides essential read-only access to the diamond's internal state and function routing. It allows developers to query raw storage values and map function selectors to their implementing facets, crucial for debugging and understanding diamond behavior.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.diamond\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of `FunctionFacetPair` structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {DiamondInspectFacet} from "@compose-protocol/diamond-contracts/facets/DiamondInspectFacet.sol";
import {IDiamondLoupe} from "@compose-protocol/diamond-contracts/interfaces/IDiamondLoupe.sol";

contract Inspector {
    address immutable diamondProxy;

    constructor(address _diamondProxy) {
        diamondProxy = _diamondProxy;
    }

    function inspectStorage() external view returns (bytes memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondProxy);
        return inspectFacet.getStorage();
    }

    function inspectFunctionMapping() external view returns (IDiamondLoupe.FacetPair[] memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondProxy);
        return inspectFacet.functionFacetPairs();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Integrate this facet to provide read-only access for debugging and auditing purposes.
- Ensure the diamond proxy address is correctly set when interacting with this facet.
- Use the returned data to verify contract logic and understand function dispatch.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet is read-only and does not directly modify state, posing minimal security risks. However, the raw storage data returned by `getStorage` should be interpreted with caution, as it is an internal representation and may not be directly usable without understanding the diamond's storage layout.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-30T15:03:14.634Z" />
