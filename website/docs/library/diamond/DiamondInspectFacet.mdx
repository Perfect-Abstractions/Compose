---
sidebar_position: 99
title: "DiamondInspectFacet"
description: "Inspect diamond storage and function-to-facet mappings."
gitSource: "https://github.com/maxnorm/Compose/blob/5736454575f67743dd05ba6cb1265bc06d0c1422/src/diamond/DiamondInspectFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Inspect diamond storage and function-to-facet mappings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Directly retrieves raw diamond storage using inline assembly.
- Maps function selectors to their implementing facet addresses.
- Provides read-only access, ensuring state integrity.
</Callout>

## Overview

The DiamondInspectFacet provides essential read-only capabilities for understanding a Compose diamond's internal state and function distribution. It allows developers to query the diamond's storage layout and map function selectors to their respective facet implementations, aiding in debugging and integration.

---

## Storage

### FacetAndPosition

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FacetAndPosition {
    address facet;
    uint32 position;
}`}
</ExpandableCode>

---
### DiamondStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct DiamondStorage {
    mapping(bytes4 functionSelector => FacetAndPosition) facetAndPosition;
    /**
    * Array of all function selectors that can be called in the diamond.
    */
    bytes4[] selectors;
}`}
</ExpandableCode>

---
### FunctionFacetPair

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct FunctionFacetPair {
    bytes4 selector;
    address facet;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "DIAMOND_STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Retrieves the diamond's storage struct from its fixed position. Uses inline assembly to access the storage slot directly.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (DiamondStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "DiamondStorage",
      description: "The &#x60;DiamondStorage&#x60; struct stored at &#x60;DIAMOND_STORAGE_POSITION&#x60;."
    }
  ]}
  showRequired={false}
/>

---
### functionFacetPairs

Returns an array of all function selectors and their corresponding facet addresses. Iterates through the diamond's stored selectors and pairs each with its facet.

<ExpandableCode language="solidity" maxLines={8}>
{`function functionFacetPairs() external view returns (FunctionFacetPair[] memory pairs);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "pairs",
      type: "FunctionFacetPair[]",
      description: "An array of &#x60;FunctionFacetPair&#x60; structs, each containing a selector and its facet address."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {DiamondInspectFacet} from "@compose/diamond-facet-inspect/DiamondInspectFacet.sol";
import {IDiamondCut} from "@compose/diamond-contracts/contracts/interfaces/IDiamondCut.sol";

contract Consumer {
    address immutable diamondAddress;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function inspectStorage() external view returns (bytes memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondAddress);
        return inspectFacet.getStorage();
    }

    function getFunctionFacetPairs() external view returns (IDiamondCut.FacetPair[] memory) {
        DiamondInspectFacet inspectFacet = DiamondInspectFacet(diamondAddress);
        return inspectFacet.functionFacetPairs();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Integrate this facet into your diamond to enable introspection capabilities.
- Access functions via the diamond proxy address to ensure correct routing.
- Use the retrieved data for debugging, auditing, and dynamic integration.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
This facet is read-only and does not modify state, mitigating reentrancy risks. Access control is managed by the diamond proxy itself. Ensure the diamond's access control mechanisms are robust, as this facet exposes internal mappings.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="DiamondInspectFacet" />
</div>

<LastUpdated date="2025-12-21T22:06:15.496Z" />
