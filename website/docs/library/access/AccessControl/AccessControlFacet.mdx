---
sidebar_position: 2
title: "AccessControlFacet"
description: "Manages role-based access control within a diamond."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/access/AccessControl/AccessControlFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manages role-based access control within a diamond.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Role-based access control (RBAC) implementation.
- Supports granting and revoking roles for individual accounts and batches.
- Allows for defining role administrators to manage role assignments.
- Emits events for role changes for off-chain monitoring.
</Callout>

## Overview

The AccessControlFacet provides a robust framework for implementing role-based access control (RBAC) within a Compose diamond. It allows for granular permission management by defining roles, assigning them to accounts, and enforcing role requirements for function execution. This facet is crucial for securing sensitive operations and ensuring that only authorized entities can perform specific actions.

---

## Storage

### AccessControlStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct AccessControlStorage {
    mapping(address account => mapping(bytes32 role => bool hasRole)) hasRole;
    mapping(bytes32 role => bytes32 adminRole) adminRole;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.accesscontrol\")`)"
    },
    {
      name: "DEFAULT_ADMIN_ROLE",
      type: "bytes32",
      description: "Default administrative role identifier (bytes32(0)) (Value: `0x00`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### hasRole

Returns if an account has a role.

<ExpandableCode language="solidity" maxLines={8}>
{`function hasRole(bytes32 _role, address _account) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check the role for."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the account has the role, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### requireRole

Checks if an account has a required role. Reverts with AccessControlUnauthorizedAccount If the account does not have the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireRole(bytes32 _role, address _account) external view;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to check."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to check the role for."
    }
  ]}
  showRequired={false}
/>

---
### getRoleAdmin

Returns the admin role for a role.

<ExpandableCode language="solidity" maxLines={8}>
{`function getRoleAdmin(bytes32 _role) external view returns (bytes32);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to get the admin for."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bytes32",
      description: "The admin role for the role."
    }
  ]}
  showRequired={false}
/>

---
### setRoleAdmin

Sets the admin role for a role. Emits a RoleAdminChanged event. Reverts with AccessControlUnauthorizedAccount If the caller is not the current admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function setRoleAdmin(bytes32 _role, bytes32 _adminRole) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to set the admin for."
    },
    {
      name: "_adminRole",
      type: "bytes32",
      description: "The new admin role to set."
    }
  ]}
  showRequired={false}
/>

---
### grantRole

Grants a role to an account. Emits a RoleGranted event. Reverts with AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function grantRole(bytes32 _role, address _account) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to grant."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to grant the role to."
    }
  ]}
  showRequired={false}
/>

---
### revokeRole

Revokes a role from an account. Emits a RoleRevoked event. Reverts with AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function revokeRole(bytes32 _role, address _account) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to revoke."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to revoke the role from."
    }
  ]}
  showRequired={false}
/>

---
### grantRoleBatch

Grants a role to multiple accounts in a single transaction. Emits a RoleGranted event for each newly granted account. Reverts with AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function grantRoleBatch(bytes32 _role, address[] calldata _accounts) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to grant."
    },
    {
      name: "_accounts",
      type: "address[]",
      description: "The accounts to grant the role to."
    }
  ]}
  showRequired={false}
/>

---
### revokeRoleBatch

Revokes a role from multiple accounts in a single transaction. Emits a RoleRevoked event for each account the role is revoked from. Reverts with AccessControlUnauthorizedAccount If the caller is not the admin of the role.

<ExpandableCode language="solidity" maxLines={8}>
{`function revokeRoleBatch(bytes32 _role, address[] calldata _accounts) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to revoke."
    },
    {
      name: "_accounts",
      type: "address[]",
      description: "The accounts to revoke the role from."
    }
  ]}
  showRequired={false}
/>

---
### renounceRole

Renounces a role from the caller. Emits a RoleRevoked event. Reverts with AccessControlUnauthorizedSender If the caller is not the account to renounce the role from.

<ExpandableCode language="solidity" maxLines={8}>
{`function renounceRole(bytes32 _role, address _account) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_role",
      type: "bytes32",
      description: "The role to renounce."
    },
    {
      name: "_account",
      type: "address",
      description: "The account to renounce the role from."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="RoleAdminChanged" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when the admin role for a role is changed.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleAdminChanged(bytes32 indexed _role, bytes32 indexed _previousAdminRole, bytes32 indexed _newAdminRole);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was changed."
          },
          {
            name: "_previousAdminRole",
            type: "bytes32",
            description: "The previous admin role."
          },
          {
            name: "_newAdminRole",
            type: "bytes32",
            description: "The new admin role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="RoleGranted" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when a role is granted to an account.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleGranted(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was granted."
          },
          {
            name: "_account",
            type: "address",
            description: "The account that was granted the role."
          },
          {
            name: "_sender",
            type: "address",
            description: "The sender that granted the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="RoleRevoked" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when a role is revoked from an account.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event RoleRevoked(bytes32 indexed _role, address indexed _account, address indexed _sender);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_role",
            type: "bytes32",
            description: "The role that was revoked."
          },
          {
            name: "_account",
            type: "address",
            description: "The account from which the role was revoked."
          },
          {
            name: "_sender",
            type: "address",
            description: "The account that revoked the role."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="AccessControlUnauthorizedAccount" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the account does not have a specific role.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlUnauthorizedAccount(address _account, bytes32 _role);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="AccessControlUnauthorizedSender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the sender is not the account to renounce the role from.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error AccessControlUnauthorizedSender(address _sender, address _account);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { DiamondAccessControl } from "@compose/access/DiamondAccessControl";
import { AccessControlFacet } from "@compose/access/AccessControl/AccessControlFacet";
import { AccessControlStorage } from "@compose/access/AccessControl/AccessControlStorage";

contract MyDiamond is DiamondAccessControl {
    bytes32 constant ACCESS_CONTROL_STORAGE_POSITION = keccak256("compose.accesscontrol");

    // Example Role Definitions
    bytes32 public constant ADMIN_ROLE = keccak256("ADMIN_ROLE");
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");

    constructor(address _diamondAdmin, address _owner) DiamondAccessControl(_diamondAdmin, _owner) {
        // Initialize AccessControlFacet
        AccessControlFacet acFacet = AccessControlFacet(address(this));
        acFacet.grantRole(ADMIN_ROLE, _diamondAdmin);
        acFacet.grantRole(ADMIN_ROLE, _owner);
        acFacet.grantRole(MINTER_ROLE, _owner);
    }

    // Function to grant MINTER_ROLE to an address
    function grantMinterRole(address _account) external {
        AccessControlFacet acFacet = AccessControlFacet(address(this));
        acFacet.grantRole(MINTER_ROLE, _account);
    }

    // Function that requires MINTER_ROLE
    function mintTokens(address _to, uint256 _amount) external {
        AccessControlFacet acFacet = AccessControlFacet(address(this));
        acFacet.requireRole(MINTER_ROLE, msg.sender);
        // ... token minting logic ...
    }

    // Function to get role admin
    function getAdminForRole(bytes32 _role) external view returns (bytes32) {
        AccessControlFacet acFacet = AccessControlFacet(address(this));
        return acFacet.getRoleAdmin(_role);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize roles and grant initial permissions during diamond deployment or upgrade initialization.
- Define role hierarchies using `setRoleAdmin` to ensure proper administrative control.
- Utilize `requireRole` within functions to enforce access control checks, reverting with specific errors if unauthorized.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Ensure that sensitive roles, such as `ADMIN_ROLE`, are only granted to trusted addresses. The `setRoleAdmin` function's access control is enforced by the current role administrator, preventing unauthorized changes to role hierarchies. Batch operations (`grantRoleBatch`, `revokeRoleBatch`) should be used cautiously to avoid unintended mass role modifications. Reentrancy is not a direct concern as functions operate on state and do not make external calls without proper checks.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "AccessControlMod",
        href: "/docs/library/access/AccessControl/AccessControlMod",
        description: "Module used by AccessControlFacet",
        icon: "ðŸ“¦"
      },
      {
        title: "OwnerTwoStepsFacet",
        href: "/docs/library/access/OwnerTwoSteps/OwnerTwoStepsFacet",
        description: "Related facet in access",
        icon: "ðŸ’Ž"
      },
      {
        title: "AccessControlPausableFacet",
        href: "/docs/library/access/AccessControlPausable/AccessControlPausableFacet",
        description: "Related facet in access",
        icon: "ðŸ’Ž"
      },
      {
        title: "AccessControlTemporalFacet",
        href: "/docs/library/access/AccessControlTemporal/AccessControlTemporalFacet",
        description: "Related facet in access",
        icon: "ðŸ’Ž"
      },
      {
        title: "OwnerFacet",
        href: "/docs/library/access/Owner/OwnerFacet",
        description: "Related facet in access",
        icon: "ðŸ’Ž"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="AccessControlFacet" />
</div>

<LastUpdated date="2025-12-30T15:37:57.431Z" />
