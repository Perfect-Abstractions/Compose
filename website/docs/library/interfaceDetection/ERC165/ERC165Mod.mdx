---
sidebar_position: 1
title: "ERC165Mod"
description: "Manage ERC-165 interface support in diamonds"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/interfaceDetection/ERC165/ERC165Mod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manage ERC-165 interface support in diamonds
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides internal functions for ERC-165 interface registration.
- Uses a dedicated diamond storage position (`STORAGE_POSITION`) for ERC-165 data.
- Enables facets to declare interface support in a composable manner.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides internal functions and storage for ERC-165 interface detection. Facets import this module to register supported interfaces during initialization. Changes to registered interfaces are stored and accessible via diamond storage, ensuring consistent interface identification across all facets.

---

## Storage

### ERC165Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC165Storage {
    /*
    * @notice Mapping of interface IDs to whether they are supported
    */
    mapping(bytes4 => bool) supportedInterfaces;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc165\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-165 storage struct. Uses inline assembly to bind the storage struct to the fixed storage position.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (ERC165Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC165Storage",
      description: "The ERC-165 storage struct."
    }
  ]}
  showRequired={false}
/>

---
### registerInterface

Register that a contract supports an interface Call this function during initialization to register supported interfaces. For example, in an ERC721 facet initialization, you would call: `LibERC165.registerInterface(type(IERC721).interfaceId)`

<ExpandableCode language="solidity" maxLines={8}>
{`function registerInterface(bytes4 _interfaceId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_interfaceId",
      type: "bytes4",
      description: "The interface ID to register"
    }
  ]}
  showRequired={false}
/>

<!-- Usage Example section commented out for now -->
<!--
## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity >=0.8.30;
import @compose/interfaceDetection/ERC165/ERC165Mod;

contract MyERC165Facet {
    function initialize() external {
        ERC165Storage storage erc165Storage = ERC165Mod.getStorage();
        erc165Storage.registerInterface(type(IERC165).interfaceId);
        // Register other interfaces supported by this facet
        erc165Storage.registerInterface(type(IMyCustomInterface).interfaceId);
    }

    // Example of how to potentially check interface support (implementation not provided)
    function supportsInterface(bytes4 interfaceId) external view returns (bool) {
        // Logic to check against registered interfaces in ERC165Storage
        return false; // Placeholder
    }
}`}
</ExpandableCode>
-->

## Best Practices

<Callout type="tip" title="Best Practice">
- Call `registerInterface` during facet initialization to declare supported interfaces.
- Ensure the `ERC165Storage` struct is correctly initialized before registering interfaces.
- Integrate interface registration as part of your diamond's upgradeable deployment flow.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
This module utilizes diamond storage at the `STORAGE_POSITION` to manage ERC-165 interface support. The `ERC165Storage` struct is bound to this position using inline assembly within the `getStorage` function. All facets that import and use this module will access and modify the same shared storage, ensuring consistent interface detection across the diamond.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC165Mod" />
</div>

<LastUpdated date="2025-12-30T18:51:16.369Z" />
