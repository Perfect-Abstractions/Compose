---
sidebar_position: 99
title: "ERC165Mod"
description: "ERC-165 interface detection and registration."
gitSource: "https://github.com/maxnorm/Compose/blob/ff6fa8311504bcc485d7920faddca96c4144627c/src/interfaceDetection/ERC165/ERC165Mod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-165 interface detection and registration.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements the ERC-165 standard for interface detection.
- Manages a persistent registry of supported interfaces within diamond storage.
- Provides internal helper functions for facets to register and query interfaces.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The ERC165Mod provides the standard ERC-165 interface detection mechanism for Compose diamonds. It manages the storage for supported interfaces and exposes functions to register new interfaces and retrieve the storage pointer, enabling facets to correctly implement the ERC-165 standard.

---

## Storage

### ERC165Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC165Storage {
/*
 * @notice Mapping of interface IDs to whether they are supported
 */
mapping(bytes4 => bool) supportedInterfaces;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc165\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-165 storage struct. Uses inline assembly to bind the storage struct to the fixed storage position.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (ERC165Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC165Storage",
      description: "The ERC-165 storage struct."
    }
  ]}
  showRequired={false}
/>

---
### registerInterface

Register that a contract supports an interface Call this function during initialization to register supported interfaces. For example, in an ERC721 facet initialization, you would call: `LibERC165.registerInterface(type(IERC721).interfaceId)`

<ExpandableCode language="solidity" maxLines={8}>
{`function registerInterface(bytes4 _interfaceId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_interfaceId",
      type: "bytes4",
      description: "The interface ID to register"
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IERC165, ERC165Mod} from "@compose-protocol/diamond-contracts/modules/erc165/ERC165Mod.sol";

contract MyFacet {
    function initialize() external {
        // Register ERC721 interface during facet initialization
        ERC165Mod.registerInterface(type(IERC721).interfaceId);
    }

    function supportsInterface(bytes4 interfaceId) external view returns (bool) {
        return ERC165Mod.supportsInterface(interfaceId);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Register all supported interfaces during facet initialization to ensure correct ERC-165 compliance.
- Call `ERC165Mod.supportsInterface(interfaceId)` within your facet's `supportsInterface` implementation for standard ERC-165 behavior.
- Ensure the `ERC165Mod` is correctly initialized and its storage is accessible.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The ERC165Mod utilizes a dedicated storage slot for its `ERC165Storage` struct. Facets interact with this storage via the `getStorage` internal function, which uses inline assembly to bind to the correct storage position. All facets should call `ERC165Mod.registerInterface` during their initialization to declare supported interfaces. The `supportsInterface` function on the diamond proxy will delegate to the ERC165Mod implementation.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC165Mod" />
</div>

<LastUpdated date="2025-12-21T20:14:42.202Z" />
