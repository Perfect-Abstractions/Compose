---
sidebar_position: 1
title: "ERC165Mod"
description: "ERC-165 Interface Detection for Diamond Contracts"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/interfaceDetection/ERC165/ERC165Mod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-165 Interface Detection for Diamond Contracts
</DocSubtitle>

<Callout type="info" title="Key Features">
- Standard ERC-165 interface detection for diamond contracts.
- Minimal gas overhead for interface checks.
- Facilitates interoperability by allowing external contracts to query supported functionality.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides essential ERC-165 interface detection capabilities for Compose diamonds. It ensures compliance with the standard, allowing external contracts to programmatically determine supported interfaces. Proper integration is crucial for interoperability and discoverability within the diamond ecosystem.

---

## Storage

### ERC165Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC165Storage {
    /*
    * @notice Mapping of interface IDs to whether they are supported
    */
    mapping(bytes4 => bool) supportedInterfaces;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc165\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-165 storage struct. Uses inline assembly to bind the storage struct to the fixed storage position.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (ERC165Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC165Storage",
      description: "The ERC-165 storage struct."
    }
  ]}
  showRequired={false}
/>

---
### registerInterface

Register that a contract supports an interface Call this function during initialization to register supported interfaces. For example, in an ERC721 facet initialization, you would call: `LibERC165.registerInterface(type(IERC721).interfaceId)`

<ExpandableCode language="solidity" maxLines={8}>
{`function registerInterface(bytes4 _interfaceId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_interfaceId",
      type: "bytes4",
      description: "The interface ID to register"
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import { ERC165Mod } from "@compose/interfaceDetection/ERC165/ERC165Mod";
import { IERC721 } from "@openzeppelin/contracts/token/ERC721/IERC721.sol";

contract MyERC721Facet {
    /**
     * @notice Initializes the ERC721 facet, registering its supported interfaces.
     */
    function initialize() external {
        // Register the ERC721 interface ID
        ERC165Mod.registerInterface(type(IERC721).interfaceId);

        // ... other initialization logic ...
    }

    /**
     * @notice Checks if the diamond supports a given interface.
     * @param _interfaceId The interface ID to check.
     * @return bool True if the interface is supported, false otherwise.
     */
    function supportsInterface(bytes4 _interfaceId) external view returns (bool) {
        // Delegate to the ERC165 module for standard interface checks
        // Note: This is a simplified example. A real implementation might query
        // the ERC165Mod storage directly or use a helper function if available.
        // For this example, we assume ERC165Mod provides a way to query.

        // Placeholder for actual interface check logic using ERC165Mod
        // Example: return ERC165Mod.supportsInterface(_interfaceId);

        // Fallback to check if it's a known interface from this facet
        return _interfaceId == type(IERC721).interfaceId;
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Call `ERC165Mod.registerInterface` during facet initialization to declare supported interfaces.
- Implement `supportsInterface` on facets that adopt ERC-165, delegating to the module for standard checks.
- Ensure the `ERC165Mod` is initialized and its storage slot is correctly set up in the diamond.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The `ERC165Mod` utilizes a dedicated storage slot identified by `keccak256("compose.erc165")` to store its `ERC165Storage` struct. Facets interact with this module primarily through its `registerInterface` function during initialization. The diamond's storage layout must accommodate this slot. Facets intending to implement ERC-165 should call `registerInterface` with their relevant `bytes4` interface IDs. The `supportsInterface` function, typically implemented by individual facets, should consult the ERC-165 module's state (or a derived state) to accurately report supported interfaces.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC165Mod" />
</div>

<LastUpdated date="2025-12-30T15:55:55.763Z" />
