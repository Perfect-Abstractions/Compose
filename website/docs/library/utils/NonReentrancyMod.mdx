---
sidebar_position: 1
title: "NonReentrancyMod"
description: "Prevent reentrant function calls within facets."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Prevent reentrant function calls within facets.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents reentrant calls to functions, enhancing security.
- Uses a simple, composable library interface for easy integration.
- Emits a `Reentrancy` error if a reentrant call is detected.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This library provides a robust mechanism to prevent reentrant function calls, a common vulnerability. By incorporating its `enter` and `exit` functions, facets can ensure that sensitive operations are executed atomically, safeguarding against unexpected state changes and exploits.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {NonReentrancyMod} from "@compose/libraries/NonReentrancyMod";

contract MyFacet {
    using NonReentrancyMod for uint256; // Example: using with a dummy type

    function sensitiveOperation() external {
        // Enter the non-reentrant guard
        NonReentrancyMod.enter();

        try {
            // Perform sensitive operations here
            // ...
        } finally {
            // Exit the non-reentrant guard
            NonReentrancyMod.exit();
        }
    }

    // Example of direct usage without try/finally
    function anotherSensitiveOperation() external {
        NonReentrancyMod.enter();
        // ... operations ...
        NonReentrancyMod.exit();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always pair `NonReentrancyMod.enter()` with `NonReentrancyMod.exit()` within a `try...finally` block to guarantee exit, even if errors occur during execution.
- Ensure `NonReentrancyMod.exit()` is called before any external calls or state-changing operations that might re-enter the current function or other protected functions.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The `NonReentrancyMod` is a library and does not directly interact with diamond storage. Its state is managed internally within the scope of the calling facet's execution context. Facets can integrate this library by importing it and calling its `enter` and `exit` functions directly. No specific storage slots are required from the diamond's perspective for this library's operation.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-30T15:56:27.297Z" />
