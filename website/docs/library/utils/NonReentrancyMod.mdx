---
sidebar_position: 99
title: "NonReentrancyMod"
description: "Prevent reentrant calls within facets."
gitSource: "https://github.com/maxnorm/Compose/blob/2dfa9eb69851162421010a7e56bd0fa891a9311a/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Prevent reentrant calls within facets.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides `enter()` and `exit()` functions to manage reentrancy locks.
- Utilizes a dedicated storage slot for reentrancy state, ensuring isolation.
- Guards against reentrancy attacks by preventing recursive calls within protected functions.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod provides essential functionality to prevent reentrant function calls within your diamond facets. By implementing checks before and after critical operations, it ensures the integrity of state transitions and guards against common reentrancy attacks.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {LibNonReentrancy} from "./libraries/LibNonReentrancy.sol";

contract MyFacet {
    using LibNonReentrancy for LibNonReentrancy.NonReentrancyStorage;

    LibNonReentrancy.NonReentrancyStorage private _nonReentrancyStorage;

    function doSomethingImportant() external {
        // Acquire reentrancy lock
        _nonReentrancyStorage.enter();

        // ... perform state-changing operations ...

        // Release reentrancy lock
        _nonReentrancyStorage.exit();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always call `enter()` at the beginning of a function that should not be reentrant.
- Always call `exit()` at the end of such a function, ensuring it is called even if an error occurs within the protected block.
- Use the `Reentrancy` custom error for clear and gas-efficient error handling.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The `LibNonReentrancy` library manages its state within a `NonReentrancyStorage` struct. This struct should be declared and initialized in the facet that utilizes the library. The `enter` and `exit` functions operate on this storage, ensuring that reentrancy protection is specific to the facet's instance of the storage. The library itself does not introduce new diamond storage slots; it relies on the facet to manage its own storage.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-21T21:45:40.876Z" />
