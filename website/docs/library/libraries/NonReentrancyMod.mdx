---
sidebar_position: 99
title: "NonReentrancyMod"
description: "Prevent reentrant calls within diamond functions."
gitSource: "https://github.com/maxnorm/Compose/blob/ff6fa8311504bcc485d7920faddca96c4144627c/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Prevent reentrant calls within diamond functions.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents reentrant function calls by tracking execution state.
- Uses `enter()` to acquire a lock and `exit()` to release it.
- Emits a specific `Reentrancy` error upon detecting a reentrant attempt.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod provides essential mechanisms to prevent reentrant function calls. By implementing the `enter` and `exit` functions, facets can enforce that a function's execution is not interrupted by another call to the same function (or another function protected by the same mechanism) before it completes. This is critical for maintaining state integrity and security in complex smart contract interactions.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {NonReentrancyMod} from "@compose/modules/NonReentrancyMod.sol";

contract MyFacet {
    NonReentrancyMod internal nonReentrancyMod;

    constructor(address _diamondProxy) {
        nonReentrancyMod = NonReentrancyMod(_diamondProxy);
    }

    function sensitiveOperation() external {
        // Check if reentrancy is already active
        if (!nonReentrancyMod.enter()) {
            // ReentrancyGuard is already active, revert with Reentrancy error
            revert NonReentrancyMod.Reentrancy();
        }

        // ... perform sensitive operations ...

        // Exit the ReentrancyGuard
        nonReentrancyMod.exit();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always pair `enter()` calls with corresponding `exit()` calls to prevent deadlocks.
- Use the `NonReentrancyMod.Reentrancy()` custom error for clear revert reasons.
- Ensure `enter()` is called at the beginning and `exit()` at the end of sensitive operations.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
NonReentrancyMod relies on a single storage slot within the diamond's storage layout to maintain its reentrancy lock status. Facets integrating this module must ensure that the `NonReentrancyMod` library is correctly initialized and that its `enter` and `exit` functions are called in the correct sequence. The state managed by this module is internal to the library and does not directly expose storage variables to other facets.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-21T20:15:06.728Z" />
