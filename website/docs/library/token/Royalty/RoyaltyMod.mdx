---
sidebar_position: 99
title: "RoyaltyMod"
description: "Manages ERC-2981 royalties with token-specific and default settings."
gitSource: "https://github.com/maxnorm/Compose/blob/fc8e8677d3c3fe32a459f173c58ec546dfcb9e13/src/token/Royalty/RoyaltyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manages ERC-2981 royalties with token-specific and default settings.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Supports both default and token-specific royalty configurations.
- Implements ERC-2981 `royaltyInfo` function logic, including fallback to default settings.
- Provides functions to set, delete, and reset royalty information.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides a robust implementation for ERC-2981 royalty standards, enabling both default royalty settings and token-specific overrides. It ensures that royalty information is always retrievable, either from token-specific configurations or a fallback default, enhancing composability for NFT marketplaces and secondary sales.

---

## Storage

### RoyaltyInfo

Structure containing royalty information. **Properties**

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
address receiver;
uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

storage-location: erc8042:compose.erc2981

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
RoyaltyInfo defaultRoyaltyInfo;
mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc2981\")`)"
    },
    {
      name: "FEE_DENOMINATOR",
      type: "uint96",
      description: " (Value: `10000`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### deleteDefaultRoyalty

Removes default royalty information. After calling this function, royaltyInfo will return (address(0), 0) for tokens without specific royalty.

<ExpandableCode language="solidity" maxLines={8}>
{`function deleteDefaultRoyalty() ;`}
</ExpandableCode>

---
### getStorage

Returns the royalty storage struct from its predefined slot. Uses inline assembly to access diamond storage location.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (RoyaltyStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "RoyaltyStorage",
      description: "The storage reference for royalty state variables."
    }
  ]}
  showRequired={false}
/>

---
### resetTokenRoyalty

Resets royalty information for a specific token to use the default setting. Clears token-specific royalty storage, causing fallback to default royalty.

<ExpandableCode language="solidity" maxLines={8}>
{`function resetTokenRoyalty(uint256 _tokenId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to reset royalty configuration for."
    }
  ]}
  showRequired={false}
/>

---
### royaltyInfo

Queries royalty information for a given token and sale price. Returns token-specific royalty or falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function logic.

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice) view returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

---
### setDefaultRoyalty

Sets the default royalty information that applies to all tokens. Validates receiver and fee, then updates default royalty storage.

<ExpandableCode language="solidity" maxLines={8}>
{`function setDefaultRoyalty(address _receiver, uint96 _feeNumerator) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_receiver",
      type: "address",
      description: "The royalty recipient address."
    },
    {
      name: "_feeNumerator",
      type: "uint96",
      description: "The royalty fee in basis points."
    }
  ]}
  showRequired={false}
/>

---
### setTokenRoyalty

Sets royalty information for a specific token, overriding the default. Validates receiver and fee, then updates token-specific royalty storage.

<ExpandableCode language="solidity" maxLines={8}>
{`function setTokenRoyalty(uint256 _tokenId, address _receiver, uint96 _feeNumerator) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to configure royalty for."
    },
    {
      name: "_receiver",
      type: "address",
      description: "The royalty recipient address."
    },
    {
      name: "_feeNumerator",
      type: "uint96",
      description: "The royalty fee in basis points."
    }
  ]}
  showRequired={false}
/>

## Errors

<AccordionGroup>
  <Accordion title="ERC2981InvalidDefaultRoyalty" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when default royalty fee exceeds 100% (10000 basis points).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidDefaultRoyalty(uint256 _numerator, uint256 _denominator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidDefaultRoyaltyReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when default royalty receiver is the zero address.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidDefaultRoyaltyReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidTokenRoyalty" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when token-specific royalty fee exceeds 100% (10000 basis points).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidTokenRoyalty(uint256 _tokenId, uint256 _numerator, uint256 _denominator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidTokenRoyaltyReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when token-specific royalty receiver is the zero address.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidTokenRoyaltyReceiver(uint256 _tokenId, address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IRoyaltyMod} from "./interfaces/IRoyaltyMod.sol";

contract RoyaltyConsumerFacet {
    address immutable DIAMOND_ADDRESS;
    IRoyaltyMod immutable royaltyMod;

    constructor(address diamondAddress) {
        DIAMOND_ADDRESS = diamondAddress;
        royaltyMod = IRoyaltyMod(diamondAddress);
    }

    /**
     * @notice Sets a royalty for a specific token.
     * @param _tokenId The ID of the token.
     * @param _receiver The address to receive royalties.
     * @param _feeBasisPoints The royalty fee in basis points.
     */
    function setTokenRoyalty(uint256 _tokenId, address _receiver, uint16 _feeBasisPoints) external {
        royaltyMod.setTokenRoyalty(_tokenId, _receiver, _feeBasisPoints);
    }

    /**
     * @notice Gets royalty information for a token.
     * @param _tokenId The ID of the token.
     * @param _salePrice The sale price of the token.
     * @return receiver The address receiving royalties.
     * @return feeAmount The amount of royalties to be paid.
     */
    function getRoyaltyInfo(uint256 _tokenId, uint256 _salePrice) external view returns (address receiver, uint256 feeAmount) {
        return royaltyMod.royaltyInfo(_tokenId, _salePrice);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure receiver addresses are validated before setting royalties to prevent unintended distributions.
- Utilize `deleteDefaultRoyalty` and `resetTokenRoyalty` judiciously to manage royalty configurations effectively.
- Be aware that royalty information is accessed via the diamond proxy, ensuring consistent behavior across facet upgrades.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The RoyaltyMod stores its state in a dedicated slot within the diamond's storage. The `getStorage` function provides direct access to this storage struct. Facets can interact with royalty logic by calling the external functions exposed by this module through the diamond proxy. Changes to default or token-specific royalties are immediately reflected in subsequent calls to `royaltyInfo`.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyMod" />
</div>

<LastUpdated date="2025-12-21T21:26:21.335Z" />
