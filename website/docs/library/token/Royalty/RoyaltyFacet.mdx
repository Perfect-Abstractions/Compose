---
sidebar_position: 99
title: "RoyaltyFacet"
description: "Manages royalty information for tokens."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/token/Royalty/RoyaltyFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manages royalty information for tokens.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements ERC-2981 `royaltyInfo` function.
- Supports token-specific royalty configurations.
- Provides a fallback to a default royalty setting.
</Callout>

## Overview

The RoyaltyFacet implements the ERC-2981 standard, enabling royalty payments on token sales. It allows for setting token-specific royalties and provides a fallback to a default royalty configuration. This facet surfaces the royalty information necessary for marketplaces and other integrators.

---

## Storage

### RoyaltyInfo

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
    address receiver;
    uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
    RoyaltyInfo defaultRoyaltyInfo;
    mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    },
    {
      name: "FEE_DENOMINATOR",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### royaltyInfo

Returns royalty information for a given token and sale price. Returns token-specific royalty if set, otherwise falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function.

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice)
    external
    view
    returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset specified by _tokenId."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IRoyaltyFacet} from "@compose/contracts/facets/Royalty/IRoyaltyFacet.sol";

contract RoyaltyConsumer {
    address immutable diamondAddress;
    bytes4 private constant ROYALTY_INFO_SELECTOR = IRoyaltyFacet.royaltyInfo.selector;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function getRoyaltyDetails(uint256 _tokenId, uint256 _salePrice) public view returns (address receiver, uint256 royaltyAmount) {
        (bool success, bytes memory data) = diamondAddress.call(abi.encodeWithSelector(ROYALTY_INFO_SELECTOR, _tokenId, _salePrice));
        require(success, "RoyaltyFacet: royaltyInfo call failed");
        (receiver, royaltyAmount) = abi.decode(data, (address, uint256));
        return (receiver, royaltyAmount);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the royalty configuration (default and token-specific) via an appropriate admin facet or deployment script.
- Ensure the `royaltyInfo` function is correctly routed to this facet by the diamond proxy.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The `royaltyInfo` function is read-only and does not pose reentrancy risks. Access control for setting royalty configurations should be managed by other facets responsible for administrative operations. Ensure correct routing to this facet to prevent unexpected behavior.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyFacet" />
</div>

<LastUpdated date="2025-12-23T00:01:54.873Z" />
