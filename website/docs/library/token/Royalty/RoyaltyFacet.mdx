---
sidebar_position: 99
title: "RoyaltyFacet"
description: "Manages and retrieves royalty information for tokens."
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/token/Royalty/RoyaltyFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Manages and retrieves royalty information for tokens.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements ERC-2981 `royaltyInfo` function.
- Supports token-specific royalty configurations.
- Falls back to default royalty settings.
- Calculates royalty fees based on sale price using basis points.
</Callout>

## Overview

The RoyaltyFacet implements the ERC-2981 standard, enabling royalty payments on secondary sales. It provides functions to retrieve royalty information for specific tokens, falling back to default settings when token-specific data is not found. This facet is crucial for creators and marketplaces to ensure fair compensation.

---

## Storage

### RoyaltyInfo

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
    address receiver;
    uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
    RoyaltyInfo defaultRoyaltyInfo;
    mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc2981\")`)"
    },
    {
      name: "FEE_DENOMINATOR",
      type: "uint96",
      description: "(Value: `10000`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### royaltyInfo

Returns royalty information for a given token and sale price. Returns token-specific royalty if set, otherwise falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function.

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice)
    external
    view
    returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset specified by _tokenId."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IRoyaltyFacet} from "@compose/contracts/facets/RoyaltyFacet.sol";

contract RoyaltyConsumer {
    address immutable diamondAddress;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function getRoyaltyDetails(uint256 _tokenId, uint256 _salePrice) public view returns (address receiver, uint256 feeBasisPoints) {
        // Assume IRoyaltyFacet interface is correctly defined and the function is correctly dispatched
        bytes4 selector = IRoyaltyFacet.royaltyInfo.selector;
        (receiver, feeBasisPoints) = abi.decode(
            DiamondProxy(diamondAddress).diamondCall(selector, abi.encodeCall(IRoyaltyFacet.royaltyInfo, (_tokenId, _salePrice))),
            (address, uint256)
        );
        return (receiver, feeBasisPoints);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the royalty storage with default royalty recipient and basis points during diamond deployment.
- Use `getStorage` to access and potentially modify the royalty storage struct if needed for upgrades or specific configurations.
- Ensure the `royaltyInfo` function is correctly implemented to handle token-specific overrides and default fallback logic.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The `royaltyInfo` function relies on external calls to potentially set royalty recipients. Ensure that the storage for royalty information is protected by appropriate access controls if modifications are allowed. The calculation of royalty fees is a percentage, so ensure the `_salePrice` and `feeBasisPoints` are validated to prevent unexpected calculations or integer overflows, although the current implementation uses standard arithmetic operations that are safe within Solidity's `uint256` limits.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyFacet" />
</div>

<LastUpdated date="2025-12-28T04:29:27.897Z" />
