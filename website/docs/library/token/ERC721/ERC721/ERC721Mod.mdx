---
sidebar_position: 1
title: "ERC721Mod"
description: "Internal logic for ERC-721 token management"
gitSource: "https://github.com/Perfect-Abstractions/Compose/tree/main/src/token/ERC721/ERC721/ERC721Mod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Internal logic for ERC-721 token management
</DocSubtitle>

<Callout type="info" title="Key Features">
- Internal functions for minting, burning, and transferring ERC-721 tokens.
- Utilizes diamond storage for shared state management.
- Reverts with specific ERC-721 errors for failed operations.
- No external dependencies, promoting composability.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

This module provides internal functions for ERC-721 token management, designed for integration into custom facets. It leverages the diamond storage pattern to ensure state is shared and consistent across facets. Use its functions to mint, burn, and transfer tokens within a Compose diamond.

---

## Storage

### ERC721Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC721Storage {
    mapping(uint256 tokenId => address owner) ownerOf;
    mapping(address owner => uint256 balance) balanceOf;
    mapping(address owner => mapping(address operator => bool approved)) isApprovedForAll;
    mapping(uint256 tokenId => address approved) approved;
    string name;
    string symbol;
    string baseURI;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.erc721\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### burn

Burns (destroys) a specific ERC-721 token. Reverts if the token does not exist. Clears ownership and approval.

<ExpandableCode language="solidity" maxLines={8}>
{`function burn(uint256 _tokenId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The ID of the token to burn."
    }
  ]}
  showRequired={false}
/>

---
### getStorage

Returns the ERC-721 storage struct from its predefined slot. Uses inline assembly to access diamond storage location.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (ERC721Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC721Storage",
      description: "The storage reference for ERC-721 state variables."
    }
  ]}
  showRequired={false}
/>

---
### mint

Mints a new ERC-721 token to the specified address. Reverts if the receiver address is zero or if the token already exists.

<ExpandableCode language="solidity" maxLines={8}>
{`function mint(address _to, uint256 _tokenId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_to",
      type: "address",
      description: "The address that will own the newly minted token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The ID of the token to mint."
    }
  ]}
  showRequired={false}
/>

---
### setMetadata

<ExpandableCode language="solidity" maxLines={8}>
{`function setMetadata(string memory _name, string memory _symbol, string memory _baseURI) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_name",
      type: "string",
      description: ""
    },
    {
      name: "_symbol",
      type: "string",
      description: ""
    },
    {
      name: "_baseURI",
      type: "string",
      description: ""
    }
  ]}
  showRequired={false}
/>

---
### transferFrom

Transfers ownership of a token ID from one address to another. Validates ownership, approval, and receiver address before updating state.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferFrom(address _from, address _to, uint256 _tokenId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address that will receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The ID of the token being transferred."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="Transfer" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when ownership of a token changes, including minting and burning.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_from",
            type: "address",
            description: "The address transferring the token, or zero for minting."
          },
          {
            name: "_to",
            type: "address",
            description: "The address receiving the token, or zero for burning."
          },
          {
            name: "_tokenId",
            type: "uint256",
            description: "The ID of the token being transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC721IncorrectOwner" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the sender is not the owner of the token.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721IncorrectOwner(address _sender, uint256 _tokenId, address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InsufficientApproval" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when an operator lacks sufficient approval to manage a token.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InsufficientApproval(address _operator, uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the receiver address is invalid (e.g., zero address).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidSender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when the sender address is invalid (e.g., zero address).
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721NonexistentToken" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when attempting to interact with a non-existent token.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721NonexistentToken(uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

<!-- Usage Example section commented out for now -->
<!--
## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity >=0.8.30;
import @compose/token/ERC721/ERC721/ERC721Mod;

contract MyERC721Facet {
    ERC721Mod internal erc721Mod;

    constructor(address diamondAddress) {
        // Assuming ERC721Mod is accessible via diamond proxy
        erc721Mod = ERC721Mod(diamondAddress);
    }

    function mintToken(address to, uint256 tokenId) external {
        erc721Mod.mint(to, tokenId);
    }

    function transferToken(address from, address to, uint256 tokenId) external {
        erc721Mod.transferFrom(from, to, tokenId);
    }

    function burnToken(uint256 tokenId) external {
        erc721Mod.burn(tokenId);
    }
}`}
</ExpandableCode>
-->

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure proper ownership and approval checks are performed before calling `transferFrom`.
- Handle `ERC721NonexistentToken`, `ERC721IncorrectOwner`, and `ERC721InsufficientApproval` errors appropriately.
- Use `mint` to create new tokens and `burn` to destroy them, ensuring state consistency.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
This module interacts with diamond storage at the slot identified by `keccak256(\"compose.erc721\")`. It reads and writes to the `ERC721Storage` struct, which contains fields for `name`, `symbol`, and `baseURI`. All state changes made through this module are immediately reflected across all facets accessing the same storage position.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <RelatedDocs
    items={[
      {
        title: "ERC20PermitMod",
        href: "/docs/library/token/ERC20/ERC20Permit/ERC20PermitMod",
        description: "Related module in token",
        icon: "ðŸ“¦"
      },
      {
        title: "ERC20Mod",
        href: "/docs/library/token/ERC20/ERC20/ERC20Mod",
        description: "Related module in token",
        icon: "ðŸ“¦"
      },
      {
        title: "ERC20BridgeableMod",
        href: "/docs/library/token/ERC20/ERC20Bridgeable/ERC20BridgeableMod",
        description: "Related module in token",
        icon: "ðŸ“¦"
      },
      {
        title: "ERC1155Mod",
        href: "/docs/library/token/ERC1155/ERC1155Mod",
        description: "Related module in token",
        icon: "ðŸ“¦"
      }
    ]}
  />
</div>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC721Mod" />
</div>

<LastUpdated date="2025-12-30T20:14:17.680Z" />
