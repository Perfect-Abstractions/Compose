---
sidebar_position: 99
title: "RoyaltyMod"
description: "LibRoyalty - ERC-2981 Royalty Standard Library - Thrown when default royalty fee exceeds 100% (10000 basis points)."
gitSource: "https://github.com/maxnorm/Compose/blob/7cec432f52f2cad53f4d546df90deb49e6a66d41/src/token/Royalty/RoyaltyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
LibRoyalty - ERC-2981 Royalty Standard Library - Thrown when default royalty fee exceeds 100% (10000 basis points).
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements the ERC-2981 &#x60;royaltyInfo&#x60; standard, providing a standardized way to query royalty details.
- Supports both a global default royalty setting and token-specific overrides, offering flexible royalty management.
- Includes functions to explicitly delete or reset royalty information, allowing for dynamic adjustments to royalty configurations.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The RoyaltyMod provides an implementation of the ERC-2981 royalty standard for Compose diamonds. It allows setting default royalties and token-specific overrides, ensuring that creators are compensated on secondary sales. This module is crucial for marketplaces and NFT platforms built on Compose, enabling composable royalty logic.

---

## Storage

### RoyaltyInfo

Structure containing royalty information. **Properties**

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
address receiver;
uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

**Note:** storage-location: erc8042:compose.erc2981

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
RoyaltyInfo defaultRoyaltyInfo;
mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

Storage position: &#x60;STORAGE_POSITION&#x60; - Used for diamond storage pattern.
---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "bytes32",
      description: " (Value: `keccak256(&quot;compose.erc2981&quot;)`)"
    },
    {
      name: "FEE_DENOMINATOR",
      type: "uint96",
      description: " (Value: `10000`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### deleteDefaultRoyalty

Removes default royalty information. After calling this function, royaltyInfo will return (address(0), 0) for tokens without specific royalty.

<ExpandableCode language="solidity" maxLines={8}>
{`function deleteDefaultRoyalty() ;`}
</ExpandableCode>

---
### getStorage

Returns the royalty storage struct from its predefined slot. Uses inline assembly to access diamond storage location. **Returns**

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() pure returns (RoyaltyStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "RoyaltyStorage",
      description: "The storage reference for royalty state variables."
    }
  ]}
  showRequired={false}
/>

---
### resetTokenRoyalty

Resets royalty information for a specific token to use the default setting. Clears token-specific royalty storage, causing fallback to default royalty. **Parameters**

<ExpandableCode language="solidity" maxLines={8}>
{`function resetTokenRoyalty(uint256 _tokenId) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to reset royalty configuration for."
    }
  ]}
  showRequired={false}
/>

---
### royaltyInfo

Queries royalty information for a given token and sale price. Returns token-specific royalty or falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function logic. **Parameters** **Returns**

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice) view returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

---
### setDefaultRoyalty

Sets the default royalty information that applies to all tokens. Validates receiver and fee, then updates default royalty storage. **Parameters**

<ExpandableCode language="solidity" maxLines={8}>
{`function setDefaultRoyalty(address _receiver, uint96 _feeNumerator) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_receiver",
      type: "address",
      description: "The royalty recipient address."
    },
    {
      name: "_feeNumerator",
      type: "uint96",
      description: "The royalty fee in basis points."
    }
  ]}
  showRequired={false}
/>

---
### setTokenRoyalty

Sets royalty information for a specific token, overriding the default. Validates receiver and fee, then updates token-specific royalty storage. **Parameters**

<ExpandableCode language="solidity" maxLines={8}>
{`function setTokenRoyalty(uint256 _tokenId, address _receiver, uint96 _feeNumerator) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to configure royalty for."
    },
    {
      name: "_receiver",
      type: "address",
      description: "The royalty recipient address."
    },
    {
      name: "_feeNumerator",
      type: "uint96",
      description: "The royalty fee in basis points."
    }
  ]}
  showRequired={false}
/>

## Errors

<AccordionGroup>
  <Accordion title="ERC2981InvalidDefaultRoyalty" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when default royalty fee exceeds 100% (10000 basis points). **Parameters**
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidDefaultRoyalty(uint256 _numerator, uint256 _denominator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidDefaultRoyaltyReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when default royalty receiver is the zero address. **Parameters**
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidDefaultRoyaltyReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidTokenRoyalty" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when token-specific royalty fee exceeds 100% (10000 basis points). **Parameters**
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidTokenRoyalty(uint256 _tokenId, uint256 _numerator, uint256 _denominator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC2981InvalidTokenRoyaltyReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Thrown when token-specific royalty receiver is the zero address. **Parameters**
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC2981InvalidTokenRoyaltyReceiver(uint256 _tokenId, address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IRoyaltyMod} from "@compose/contracts/modules/royalty/IRoyaltyMod.sol";

contract MyRoyaltyFacet {
    // Assume IRoyaltyMod is correctly implemented and accessible via the diamond proxy
    IRoyaltyMod internal royaltyMod;

    // Initialize with the diamond proxy address
    function initialize(address _diamondProxy) public {
        royaltyMod = IRoyaltyMod(_diamondProxy);
    }

    /**
     * @notice Sets a default royalty for all tokens.
     * @param _receiver The address to receive royalties.
     * @param _feeBasisPoints The royalty fee in basis points (e.g., 1000 for 10%).
     */
    function grantDefaultRoyalty(address _receiver, uint16 _feeBasisPoints) external {
        royaltyMod.setDefaultRoyalty(_receiver, _feeBasisPoints);
    }

    /**
     * @notice Sets a specific royalty for a token ID.
     * @param _tokenId The ID of the token to set royalty for.
     * @param _receiver The address to receive royalties.
     * @param _feeBasisPoints The royalty fee in basis points (e.g., 1000 for 10%).
     */
    function grantTokenRoyalty(uint256 _tokenId, address _receiver, uint16 _feeBasisPoints) external {
        royaltyMod.setTokenRoyalty(_tokenId, _receiver, _feeBasisPoints);
    }

    /**
     * @notice Retrieves royalty information for a token and sale price.
     * @param _tokenId The ID of the token.
     * @param _salePrice The sale price of the token.
     * @return receiver The address entitled to the royalty.
     * @return royaltyAmount The calculated royalty amount.
     */
    function getRoyaltyDetails(uint256 _tokenId, uint256 _salePrice) external view returns (address receiver, uint256 royaltyAmount) {
        (receiver, royaltyAmount) = royaltyMod.royaltyInfo(_tokenId, _salePrice);
        return (receiver, royaltyAmount);
    }
}
`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Ensure the &#x60;_feeBasisPoints&#x60; parameter in &#x60;setDefaultRoyalty&#x60; and &#x60;setTokenRoyalty&#x60; does not exceed 10000 (100%) to prevent excessive fees. The library enforces this, but explicit checks in calling facets can add an extra layer of safety.
- When resetting token-specific royalties using &#x60;resetTokenRoyalty&#x60;, be aware that it reverts to the default royalty settings. Ensure the default royalty is configured appropriately if this action is intended.
- Use custom errors or specific revert messages when calling functions to clearly indicate the reason for failure, especially during royalty setting operations.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The RoyaltyMod interacts with diamond storage to manage default royalty information and token-specific royalty configurations. Facets can access this module via its interface, and calls to functions like &#x60;royaltyInfo&#x60; will transparently query the appropriate storage slots within the diamond&#x27;s storage layout. The &#x60;getStorage&#x60; function provides direct access to the internal storage struct, which is useful for advanced inspection or complex logic but should be used with caution to maintain storage hygiene. Changes to default royalties are immediately reflected in subsequent &#x60;royaltyInfo&#x60; calls for tokens without specific overrides. Token-specific royalties directly override the default for the specified token ID.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyMod" />
</div>

<LastUpdated date="2025-12-19T21:23:44.040Z" />
