---
sidebar_position: 99
title: "OwnerTwoStepsMod"
description: "ERC-173 Two-Step Contract Ownership Library - Provides two-step ownership transfer logic for facets or modular contracts."
gitSource: "https://github.com/maxnorm/Compose/blob/8fcbb812c7f4f59338db6b04ce17631a729a30f9/src/access/OwnerTwoSteps/OwnerTwoStepsMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-173 Two-Step Contract Ownership Library - Provides two-step ownership transfer logic for facets or modular contracts.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements a secure two-step ownership transfer process, mitigating risks of accidental ownership loss.
- Provides `owner()` and `pendingOwner()` view functions for transparent state inspection.
- Includes `requireOwner()` for enforcing access control on sensitive operations.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The OwnerTwoStepsMod provides a secure, two-step ownership transfer mechanism, crucial for managing diamond proxies and their facets. This pattern prevents accidental loss of control by requiring explicit acceptance of ownership, enhancing safety and composability within the diamond architecture.

---

## Storage

### OwnerStorage

storage-location: erc8042:compose.owner

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct OwnerStorage {
address owner;
}`}
</ExpandableCode>

---
### PendingOwnerStorage

storage-location: erc8042:compose.owner.pending

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct PendingOwnerStorage {
address pendingOwner;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "OWNER_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.owner\")`)"
    },
    {
      name: "PENDING_OWNER_STORAGE_POSITION",
      type: "bytes32",
      description: "Diamond storage slot position for this module (Value: `keccak256(\"compose.owner.pending\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### acceptOwnership

Finalizes ownership transfer; must be called by the pending owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function acceptOwnership() ;`}
</ExpandableCode>

---
### getOwnerStorage

Returns a pointer to the Owner storage struct. Uses inline assembly to access the storage slot defined by OWNER_STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getOwnerStorage() pure returns (OwnerStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "OwnerStorage",
      description: "The OwnerStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### getPendingOwnerStorage

Returns a pointer to the PendingOwner storage struct. Uses inline assembly to access the storage slot defined by PENDING_OWNER_STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getPendingOwnerStorage() pure returns (PendingOwnerStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "PendingOwnerStorage",
      description: "The PendingOwnerStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### owner

Returns the current owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function owner() view returns (address);`}
</ExpandableCode>

---
### pendingOwner

Returns the pending owner (if any).

<ExpandableCode language="solidity" maxLines={8}>
{`function pendingOwner() view returns (address);`}
</ExpandableCode>

---
### renounceOwnership

Renounce ownership of the contract Sets the owner to address(0), disabling all functions restricted to the owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function renounceOwnership() ;`}
</ExpandableCode>

---
### requireOwner

Reverts if the caller is not the owner.

<ExpandableCode language="solidity" maxLines={8}>
{`function requireOwner() view;`}
</ExpandableCode>

---
### transferOwnership

Initiates a two-step ownership transfer.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferOwnership(address _newOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_newOwner",
      type: "address",
      description: "The address of the new owner of the contract"
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="OwnershipTransferStarted" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when ownership transfer is initiated (pending owner set).
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event OwnershipTransferStarted(address indexed _previousOwner, address indexed _newOwner);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="OwnershipTransferred" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when ownership transfer is finalized.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event OwnershipTransferred(address indexed _previousOwner, address indexed _newOwner);`}
      </ExpandableCode>
    </div>

  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="OwnerAlreadyRenounced" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error OwnerAlreadyRenounced();
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="OwnerUnauthorizedAccount" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error OwnerUnauthorizedAccount();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {OwnerTwoStepsMod} from "../modules/OwnerTwoStepsMod.sol";

contract MyFacet is OwnerTwoStepsMod {
    // Assuming OWNER_STORAGE_POSITION and PENDING_OWNER_STORAGE_POSITION are defined
    // and initialized correctly within the diamond deployment.

    /**
     * @notice Transfers ownership to a new address.
     * @param _newOwner The address to transfer ownership to.
     */
    function initiateOwnershipTransfer(address _newOwner) external {
        transferOwnership(_newOwner);
    }

    /**
     * @notice Accepts an incoming ownership transfer.
     */
    function acceptNewOwnership() external {
        acceptOwnership();
    }

    /**
     * @notice Renounces current ownership.
     */
    function giveUpOwnership() external {
        renounceOwnership();
    }

    /**
     * @notice Returns the current owner of the diamond.
     */
    function getCurrentOwner() external view returns (address) {
        return owner();
    }

    /**
     * @notice Returns the pending owner of the diamond.
     */
    function getPendingOwnerAddress() external view returns (address) {
        return pendingOwner();
    }
}
`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always call `transferOwnership` from the current owner and `acceptOwnership` from the pending owner to ensure a valid two-step transfer.
- Use `requireOwner` to protect critical administrative functions within your facets.
- Be aware that `renounceOwnership` permanently removes owner privileges; use with extreme caution.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
This module interacts with diamond storage by reading and writing to specific storage slots designated for the owner and pending owner. Facets integrating this module must ensure that `OWNER_STORAGE_POSITION` and `PENDING_OWNER_STORAGE_POSITION` are correctly defined and initialized within the diamond's storage layout. Changes to these storage variables are immediately visible to all facets interacting with the diamond.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="OwnerTwoStepsMod" />
</div>

<LastUpdated date="2025-12-20T02:02:05.497Z" />
