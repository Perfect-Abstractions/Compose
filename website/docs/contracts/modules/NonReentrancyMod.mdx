---
sidebar_position: 99
title: "NonReentrancyMod"
description: "LibNonReentrancy - Non-Reentrancy Library - Provides common non-reentrant functions for Solidity contracts."
gitSource: "https://github.com/maxnorm/Compose/blob/4f58223f08f652d9b72a6792643c40cac4f0f4a0/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
LibNonReentrancy - Non-Reentrancy Library - Provides common non-reentrant functions for Solidity contracts.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Prevents reentrant function calls by maintaining a simple lock state.
- Designed for seamless integration into Compose diamond facets using the `using for` directive.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod provides essential utilities to prevent reentrancy attacks within your diamond facets. By integrating this module, you can ensure that sensitive operations are executed atomically, safeguarding your contract's state integrity.

---

## Storage

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(&quot;compose.nonreentrant&quot;)`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {LibNonReentrancy} from "@compose-protocol/contracts/src/modules/non-reentrancy/LibNonReentrancy.sol";

contract MyFacet {
    using LibNonReentrancy for uint256;

    uint256 private _lock;

    /**
     * @notice Example function protected by non-reentrancy.
     */
    function protectedAction() external {
        // Acquire the lock before executing sensitive logic.
        _lock.enter();

        // ... perform sensitive operations ...

        // Release the lock after operations are complete.
        _lock.exit();
    }

    /**
     * @notice Another function demonstrating reentrancy protection.
     */
    function anotherAction() external {
        // Enter the non-reentrancy lock.
        _lock.enter();

        // ... perform operations ...

        // Exit the non-reentrancy lock.
        _lock.exit();
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always pair `enter()` with `exit()` to ensure the lock is released, even in the event of an internal revert.
- Use `_lock.enter()` immediately upon entering a function and `_lock.exit()` just before returning or reverting to maximize protection.
- Integrate this module into facets that handle critical state changes or asset transfers to prevent recursive calls.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The NonReentrancyMod relies on a single `uint256` storage variable to track the reentrancy lock. Facets using this module should declare a `uint256` variable (e.g., `_lock`) and associate it with the `LibNonReentrancy` library using `using LibNonReentrancy for uint256;`. The `enter()` function increments this variable, and `exit()` decrements it. It is crucial that the storage slot for this lock variable is not shared or modified by other facets in a way that could compromise the lock's integrity. The order of operations within a facet is critical: `enter()` must be called before any potentially reentrant calls, and `exit()` must be called after all sensitive operations are completed.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-19T22:47:29.851Z" />
