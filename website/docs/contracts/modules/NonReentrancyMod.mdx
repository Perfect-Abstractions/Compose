---
sidebar_position: 99
title: "NonReentrancyMod"
description: "LibNonReentrancy - Non-Reentrancy Library - Provides common non-reentrant functions for Solidity contracts."
gitSource: "https://github.com/maxnorm/Compose/blob/8fcbb812c7f4f59338db6b04ce17631a729a30f9/src/libraries/NonReentrancyMod.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
LibNonReentrancy - Non-Reentrancy Library - Provides common non-reentrant functions for Solidity contracts.
</DocSubtitle>

<Callout type="info" title="Key Features">
- Provides `enter()` and `exit()` functions to manage reentrancy locks.
- Designed for integration into custom facets or as a library function using `using for`.
- Aids in maintaining state consistency by preventing recursive function calls within a single transaction context.
</Callout>

<Callout type="info" title="Module Usage">
This module provides internal functions for use in your custom facets. Import it to access shared logic and storage.
</Callout>

## Overview

The NonReentrancyMod provides essential utilities to prevent reentrant calls within your diamond facets. By implementing reentrancy guards, it ensures the integrity and security of your contract's state during complex interactions, which is crucial for maintaining predictable execution flows in a composable diamond architecture.

---

## Storage

### State Variables

<PropertyTable
  properties={[
    {
      name: "NON_REENTRANT_SLOT",
      type: "bytes32",
      description: "Reentrancy guard storage slot (Value: `keccak256(\"compose.nonreentrant\")`)"
    }
  ]}
  showRequired={false}
/>

## Functions

### enter

How to use as a library in user facets How to use as a modifier in user facets This unlocks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function enter() ;`}
</ExpandableCode>

---
### exit

This locks the entry into a function

<ExpandableCode language="solidity" maxLines={8}>
{`function exit() ;`}
</ExpandableCode>

## Errors

<AccordionGroup>
  <Accordion title="Reentrancy" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Function selector - 0x43a0d067
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error Reentrancy();
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {LibNonReentrancy} from "@compose/core/src/modules/NonReentrancyMod.sol";

contract MyFacet {
    using LibNonReentrancy for uint256;

    uint256 internal _reentrancyGuard;

    /**
     * @notice Performs an action that must be non-reentrant.
     */
    function sensitiveAction() external {
        // Enter the non-reentrancy guard.
        _reentrancyGuard.enter();

        try {
            // Perform sensitive operations here.
            // ...
        } finally {
            // Exit the non-reentrancy guard.
            _reentrancyGuard.exit();
        }
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Always ensure `exit()` is called, even if an error occurs during the protected operation. Use `try...finally` blocks for robust error handling.
- Store the reentrancy guard variable within your facet's storage, following Compose's storage pattern guidelines.
- Consider the implications of reentrancy when designing interactions between different facets; this module provides a fundamental safeguard.
</Callout>

## Integration Notes

<Callout type="success" title="Shared Storage">
The `NonReentrancyMod` is typically integrated by adding a `uint256` variable to the facet's storage to act as the reentrancy guard. This variable is then managed by the `enter()` and `exit()` functions. Facets that wish to use this module should include it in their storage layout and apply the library functions to their designated guard variable. The guard variable's state (locked or unlocked) is local to the facet using it.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="NonReentrancyMod" />
</div>

<LastUpdated date="2025-12-20T02:04:24.955Z" />
