---
sidebar_position: 99
title: "RoyaltyFacet"
description: "**Title:**"
gitSource: "https://github.com/maxnorm/Compose/blob/8fd3d0c28913baf3b948e02cb6af2111875ad106/src/token/Royalty/RoyaltyFacet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
**Title:**
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements the ERC-2981 `royaltyInfo` function for standardized royalty queries.
- Supports token-specific royalty overrides on top of a default royalty configuration.
- Utilizes inline assembly for efficient access to its designated storage slot.
</Callout>

## Overview

The RoyaltyFacet manages and exposes royalty information for NFTs within a Compose diamond. It implements the ERC-2981 standard, providing a standardized way to query royalty details for specific tokens and sale prices, ensuring creators receive their due compensation.

---

## Storage

### RoyaltyInfo

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyInfo {
    address receiver;
    uint96 royaltyFraction;
}`}
</ExpandableCode>

---
### RoyaltyStorage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct RoyaltyStorage {
    RoyaltyInfo defaultRoyaltyInfo;
    mapping(uint256 tokenId => RoyaltyInfo) tokenRoyaltyInfo;
}`}
</ExpandableCode>

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    },
    {
      name: "FEE_DENOMINATOR",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the royalty storage struct. Uses inline assembly to access the storage slot defined by STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (RoyaltyStorage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "RoyaltyStorage",
      description: "The RoyaltyStorage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### royaltyInfo

Returns royalty information for a given token and sale price. Returns token-specific royalty if set, otherwise falls back to default royalty. Royalty amount is calculated as a percentage of the sale price using basis points. Implements the ERC-2981 royaltyInfo function.

<ExpandableCode language="solidity" maxLines={8}>
{`function royaltyInfo(uint256 _tokenId, uint256 _salePrice)
    external
    view
    returns (address receiver, uint256 royaltyAmount);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The NFT asset queried for royalty information."
    },
    {
      name: "_salePrice",
      type: "uint256",
      description: "The sale price of the NFT asset specified by _tokenId."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "receiver",
      type: "address",
      description: "The address designated to receive the royalty payment."
    },
    {
      name: "royaltyAmount",
      type: "uint256",
      description: "The royalty payment amount for _salePrice."
    }
  ]}
  showRequired={false}
/>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IDiamond} from "@compose/diamond/contracts/IDiamond.sol";
import {IRoyaltyFacet} from "@compose/diamond/facets/RoyaltyFacet/IRoyaltyFacet.sol";

contract RoyaltyConsumer {
    IDiamond public diamond;

    constructor(address _diamondAddress) {
        diamond = IDiamond(_diamondAddress);
    }

    function getRoyaltyInfo(uint256 _tokenId, uint256 _salePrice) public view returns (address receiver, uint256 feeBasisPoints) {
        // Route to the RoyaltyFacet's royaltyInfo function
        (bool success, bytes memory data) = diamond.diamondCut(
            diamond.getFacetFunctionSelector(IRoyaltyFacet.royaltyInfo.selector),
            abi.encodeCall(IRoyaltyFacet.royaltyInfo, (_tokenId, _salePrice))
        );
        require(success, "RoyaltyConsumer: Failed to get royalty info");
        (receiver, feeBasisPoints) = abi.decode(data, (address, uint256));
        return (receiver, feeBasisPoints);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the RoyaltyFacet with default royalty settings during diamond deployment.
- Ensure the correct access control is in place if functions for setting default or token-specific royalties are implemented in other facets or a dedicated admin facet.
- When upgrading or adding facets, ensure the royalty storage slot (STORAGE_POSITION) remains consistent to avoid data loss.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The `royaltyInfo` function itself is read-only and poses no direct reentrancy risk. However, ensure that any facets responsible for *setting* royalty information (default or token-specific) implement robust access control and input validation to prevent unauthorized modifications. State coupling is minimal, as this facet primarily reads its own storage and does not interact with external state beyond what's necessary for its read operations.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="RoyaltyFacet" />
</div>

<LastUpdated date="2025-12-19T22:26:10.752Z" />
