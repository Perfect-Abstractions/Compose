---
sidebar_position: 99
title: "ERC1155Facet"
description: "ERC-1155 multi-token facet for Compose diamonds"
gitSource: "https://github.com/maxnorm/Compose/blob/8fcbb812c7f4f59338db6b04ce17631a729a30f9/src/token/ERC1155/ERC1155Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-1155 multi-token facet for Compose diamonds
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements the ERC-1155 Multi-Token Standard, supporting both fungible and non-fungible tokens.
- Provides batched transfer and balance checking functions (`balanceOfBatch`, `safeBatchTransferFrom`) for efficiency.
- Supports customizable token URIs, allowing for dynamic metadata based on token ID and an optional base URI.
</Callout>

## Overview

The ERC1155Facet implements the ERC-1155 multi-token standard for Compose diamonds. It provides core functionalities for managing and transferring fungible and non-fungible tokens within the diamond's composable architecture.

---

## Storage

### ERC1155Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC1155Storage {
    mapping(uint256 id => mapping(address account => uint256 balance)) balanceOf;
    mapping(address account => mapping(address operator => bool)) isApprovedForAll;
    string uri;
    string baseURI;
    mapping(uint256 tokenId => string) tokenURIs;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns the ERC-1155 storage struct from the predefined diamond storage slot. Uses inline assembly to set the storage slot reference.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (ERC1155Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC1155Storage",
      description: "The ERC-1155 storage struct reference."
    }
  ]}
  showRequired={false}
/>

---
### uri

Returns the URI for token type `_id`. If a token-specific URI is set in tokenURIs[_id], returns the concatenation of baseURI and tokenURIs[_id]. Note that baseURI is empty by default and must be set explicitly if concatenation is desired. If no token-specific URI is set, returns the default URI which applies to all token types. The default URI may contain the substring `&#123;id&#125;` which clients should replace with the actual token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function uri(uint256 _id) external view returns (string memory);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_id",
      type: "uint256",
      description: "The token ID to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The URI for the token type."
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Returns the amount of tokens of token type `id` owned by `account`.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _account, uint256 _id) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_account",
      type: "address",
      description: "The address to query the balance of."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The token type to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The balance of the token type."
    }
  ]}
  showRequired={false}
/>

---
### balanceOfBatch

Batched version of balanceOf.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOfBatch(address[] calldata _accounts, uint256[] calldata _ids)
    external
    view
    returns (uint256[] memory balances);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_accounts",
      type: "address[]",
      description: "The addresses to query the balances of."
    },
    {
      name: "_ids",
      type: "uint256[]",
      description: "The token types to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "balances",
      type: "uint256[]",
      description: "The balances of the token types."
    }
  ]}
  showRequired={false}
/>

---
### setApprovalForAll

Grants or revokes permission to `operator` to transfer the caller's tokens. Emits an ApprovalForAll event.

<ExpandableCode language="solidity" maxLines={8}>
{`function setApprovalForAll(address _operator, bool _approved) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_operator",
      type: "address",
      description: "The address to grant/revoke approval to."
    },
    {
      name: "_approved",
      type: "bool",
      description: "True to approve, false to revoke."
    }
  ]}
  showRequired={false}
/>

---
### isApprovedForAll

Returns true if `operator` is approved to transfer `account`'s tokens.

<ExpandableCode language="solidity" maxLines={8}>
{`function isApprovedForAll(address _account, address _operator) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_account",
      type: "address",
      description: "The token owner."
    },
    {
      name: "_operator",
      type: "address",
      description: "The operator to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the operator is approved, false otherwise."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Transfers `value` amount of token type `id` from `from` to `to`. Emits a TransferSingle event.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _id, uint256 _value, bytes calldata _data) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The address to transfer from."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to transfer to."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The token type to transfer."
    },
    {
      name: "_value",
      type: "uint256",
      description: "The amount to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

---
### safeBatchTransferFrom

Batched version of safeTransferFrom. Emits a TransferBatch event.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeBatchTransferFrom(
    address _from,
    address _to,
    uint256[] calldata _ids,
    uint256[] calldata _values,
    bytes calldata _data
) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The address to transfer from."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to transfer to."
    },
    {
      name: "_ids",
      type: "uint256[]",
      description: "The token types to transfer."
    },
    {
      name: "_values",
      type: "uint256[]",
      description: "The amounts to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="TransferSingle" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when `value` amount of tokens of type `id` are transferred from `from` to `to` by `operator`.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TransferSingle(
    address indexed _operator, address indexed _from, address indexed _to, uint256 _id, uint256 _value
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_operator",
            type: "address",
            description: "The address which initiated the transfer."
          },
          {
            name: "_from",
            type: "address",
            description: "The address which previously owned the token."
          },
          {
            name: "_to",
            type: "address",
            description: "The address which now owns the token."
          },
          {
            name: "_id",
            type: "uint256",
            description: "The token type being transferred."
          },
          {
            name: "_value",
            type: "uint256",
            description: "The amount of tokens transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="TransferBatch" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Equivalent to multiple TransferSingle events, where `operator`, `from` and `to` are the same for all transfers.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event TransferBatch(
    address indexed _operator, address indexed _from, address indexed _to, uint256[] _ids, uint256[] _values
);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_operator",
            type: "address",
            description: "The address which initiated the batch transfer."
          },
          {
            name: "_from",
            type: "address",
            description: "The address which previously owned the tokens."
          },
          {
            name: "_to",
            type: "address",
            description: "The address which now owns the tokens."
          },
          {
            name: "_ids",
            type: "uint256[]",
            description: "The token types being transferred."
          },
          {
            name: "_values",
            type: "uint256[]",
            description: "The amounts of tokens transferred."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="ApprovalForAll" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when `account` grants or revokes permission to `operator` to transfer their tokens.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event ApprovalForAll(address indexed _account, address indexed _operator, bool _approved);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_account",
            type: "address",
            description: "The token owner granting/revoking approval."
          },
          {
            name: "_operator",
            type: "address",
            description: "The address being approved/revoked."
          },
          {
            name: "_approved",
            type: "bool",
            description: "True if approval is granted, false if revoked."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
  <Accordion title="URI" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Emitted when the URI for token type `id` changes to `value`.
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event URI(string _value, uint256 indexed _id);`}
      </ExpandableCode>
    </div>

    <div style={{marginBottom: "1rem"}}>
      <strong>Parameters:</strong>
      <PropertyTable
        properties={[
          {
            name: "_value",
            type: "string",
            description: "The new URI for the token type."
          },
          {
            name: "_id",
            type: "uint256",
            description: "The token type whose URI changed."
          }
        ]}
        showRequired={false}
      />
    </div>
  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC1155InsufficientBalance" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating insufficient balance for a transfer.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InsufficientBalance(address _sender, uint256 _balance, uint256 _needed, uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidSender" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the sender address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidReceiver" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the receiver address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155MissingApprovalForAll" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating missing approval for an operator.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155MissingApprovalForAll(address _operator, address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidApprover" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the approver address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidApprover(address _approver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidOperator" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating the operator address is invalid.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidOperator(address _operator);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC1155InvalidArrayLength" defaultOpen={false}>
    <div style={{marginBottom: "1rem"}}>
      Error indicating array length mismatch in batch operations.
    </div>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC1155InvalidArrayLength(uint256 _idsLength, uint256 _valuesLength);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IDiamondCut, IERC1155Facet} from \"@compose/contracts/src/interfaces/IDiamond.sol\";

contract ERC1155Deployer {
    address immutable diamondAddress;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function deployERC1155Facet(address _diamondCutAddress) external {
        // Assume ERC1155Facet contract is deployed and its address is known
        address erc1155FacetAddress = address(0xYourERC1155FacetAddress);

        // Define the functions to be added by this facet
        bytes4[] memory selectors = new bytes4[](8);
        selectors[0] = IERC1155Facet.getStorage.selector;
        selectors[1] = IERC1155Facet.uri.selector;
        selectors[2] = IERC1155Facet.balanceOf.selector;
              selectors[3] = IERC1155Facet.balanceOfBatch.selector;
        selectors[4] = IERC1155Facet.setApprovalForAll.selector;
        selectors[5] = IERC1155Facet.isApprovedForAll.selector;
        selectors[6] = IERC1155Facet.safeTransferFrom.selector;
        selectors[7] = IERC1155Facet.safeBatchTransferFrom.selector;

        // Prepare the DiamondCut data
        IDiamondCut.FacetCut[] memory cuts = new IDiamondCut.FacetCut[](1);
        cuts[0] = IDiamondCut.FacetCut({
            facetAddress: erc1155FacetAddress,
            action: IDiamondCut.FacetCutAction.ADD,
            functionSelectors: selectors
        });

        // Execute the diamond cut to add the ERC1155 facet
        bytes memory data = abi.encodeWithSelector(IDiamondCut.diamondCut.selector, cuts);
        // Assuming IDiamondCut interface is accessible and the diamond supports the cut
        // The actual call would be to the diamond proxy's fallback or delegatecall mechanism
        // For simplicity, this example shows the intended data structure.
        // In a real deployment, you'd call the diamond proxy directly with this data.
        // Example: _diamondCutAddress.diamondCut(cuts);
    }

    // Example of calling functions on the ERC1155 facet via the diamond proxy
    function callERC1155Functions() external {
        // Assuming IERC1155Facet interface is available and diamondAddress is set
        IERC1155Facet erc1155 = IERC1155Facet(diamondAddress);

        // Example: Get balance of token ID 1 for address(this)
        uint256 balance = erc1155.balanceOf(address(this), 1);

        // Example: Get URI for token ID 2
        string memory tokenUri = erc1155.uri(2);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the ERC1155 facet with necessary configuration, such as setting a base URI if token-specific URIs will be used for concatenation. Ensure the diamond's storage slot for ERC1155 is correctly set during deployment or upgrades.
- When upgrading, ensure that the function selectors for the ERC1155 facet are correctly managed to maintain compatibility and prevent accidental removal of critical functions.
- Carefully manage access control for functions that modify state (e.g., `setApprovalForAll`) by integrating with the diamond's access control mechanisms, if applicable, to restrict sensitive operations.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The `safeTransferFrom` and `safeBatchTransferFrom` functions must be called with valid parameters to prevent unintended token transfers or loss. Ensure that the caller has sufficient allowance or ownership of the tokens being transferred. The `setApprovalForAll` function grants broad permissions to an operator, so callers should exercise caution when approving addresses. Reentrancy is not an explicit concern within the facet's core transfer logic as it relies on standard ERC-1155 patterns, but external contract interactions initiated by the diamond proxy should be audited for reentrancy risks.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC1155Facet" />
</div>

<LastUpdated date="2025-12-20T02:03:16.603Z" />
