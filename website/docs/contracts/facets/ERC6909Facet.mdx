---
sidebar_position: 99
title: "ERC6909Facet"
description: "**Title:**"
gitSource: "https://github.com/maxnorm/Compose/blob/7cec432f52f2cad53f4d546df90deb49e6a66d41/src/token/ERC6909/ERC6909/ERC6909Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
**Title:**
</DocSubtitle>

<Callout type="info" title="Key Features">
- Implements the ERC-6909 standard for flexible token management.
- Supports both fungible and non-fungible token semantics through token IDs.
- Provides explicit functions for balance checks, allowances, and operator approvals.
- Enables direct token transfers via &#x60;transfer&#x60; and &#x60;transferFrom&#x60;.
</Callout>

## Overview

The ERC6909Facet implements the ERC-6909 standard for fungible and non-fungible tokens within a Compose diamond. It provides core functionalities for managing token balances, allowances, operator approvals, and executing transfers, acting as a primary interface for token interactions.

---

## Storage

### ERC6909Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC6909Storage {
    mapping(address owner => mapping(uint256 id => uint256 amount)) balanceOf;
    mapping(address owner => mapping(address spender => mapping(uint256 id => uint256 amount))) allowance;
    mapping(address owner => mapping(address spender => bool)) isOperator;
}`}
</ExpandableCode>

---
### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: ""
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-6909 storage struct. Uses inline assembly to access the storage slot defined by STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (ERC6909Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC6909Storage",
      description: "The ERC6909Storage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Owner balance of an id.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _owner, uint256 _id) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the owner."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The id of the token."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The balance of the token."
    }
  ]}
  showRequired={false}
/>

---
### allowance

Spender allowance of an id.

<ExpandableCode language="solidity" maxLines={8}>
{`function allowance(address _owner, address _spender, uint256 _id) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the owner."
    },
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The id of the token."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The allowance of the token."
    }
  ]}
  showRequired={false}
/>

---
### isOperator

Checks if a spender is approved by an owner as an operator.

<ExpandableCode language="solidity" maxLines={8}>
{`function isOperator(address _owner, address _spender) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address of the owner."
    },
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "The approval status."
    }
  ]}
  showRequired={false}
/>

---
### transfer

Transfers an amount of an id from the caller to a receiver.

<ExpandableCode language="solidity" maxLines={8}>
{`function transfer(address _receiver, uint256 _id, uint256 _amount) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_receiver",
      type: "address",
      description: "The address of the receiver."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The id of the token."
    },
    {
      name: "_amount",
      type: "uint256",
      description: "The amount of the token."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "Whether the transfer succeeded."
    }
  ]}
  showRequired={false}
/>

---
### transferFrom

Transfers an amount of an id from a sender to a receiver.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferFrom(address _sender, address _receiver, uint256 _id, uint256 _amount) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_sender",
      type: "address",
      description: "The address of the sender."
    },
    {
      name: "_receiver",
      type: "address",
      description: "The address of the receiver."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The id of the token."
    },
    {
      name: "_amount",
      type: "uint256",
      description: "The amount of the token."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "Whether the transfer succeeded."
    }
  ]}
  showRequired={false}
/>

---
### approve

Approves an amount of an id to a spender.

<ExpandableCode language="solidity" maxLines={8}>
{`function approve(address _spender, uint256 _id, uint256 _amount) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    },
    {
      name: "_id",
      type: "uint256",
      description: "The id of the token."
    },
    {
      name: "_amount",
      type: "uint256",
      description: "The amount of the token."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "Whether the approval succeeded."
    }
  ]}
  showRequired={false}
/>

---
### setOperator

Sets or removes a spender as an operator for the caller.

<ExpandableCode language="solidity" maxLines={8}>
{`function setOperator(address _spender, bool _approved) external returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_spender",
      type: "address",
      description: "The address of the spender."
    },
    {
      name: "_approved",
      type: "bool",
      description: "The approval status."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "Whether the operator update succeeded."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="Transfer" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Transfer(
    address _caller, address indexed _sender, address indexed _receiver, uint256 indexed _id, uint256 _amount
);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="OperatorSet" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event OperatorSet(address indexed _owner, address indexed _spender, bool _approved);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="Approval" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Approval(address indexed _owner, address indexed _spender, uint256 indexed _id, uint256 _amount);`}
      </ExpandableCode>
    </div>

  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC6909InsufficientBalance" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC6909InsufficientBalance(address _sender, uint256 _balance, uint256 _needed, uint256 _id);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC6909InsufficientAllowance" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC6909InsufficientAllowance(address _spender, uint256 _allowance, uint256 _needed, uint256 _id);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC6909InvalidReceiver" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC6909InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC6909InvalidSender" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC6909InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC6909InvalidSpender" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC6909InvalidSpender(address _spender);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IERC6909Facet} from "@compose/contracts/interfaces/token/ERC6909/IERC6909Facet.sol";
import {IERC6909Storage} from "@compose/contracts/interfaces/token/ERC6909/IERC6909Storage.sol";

contract ERC6909Consumer {
    // Assume diamondAbi is the ABI of your diamond proxy
    // Assume diamondAddress is the address of your diamond proxy
    IERC6909Facet public erc6909Facet;

    constructor(address diamondAddress) {
        erc6909Facet = IERC6909Facet(diamondAddress);
    }

    function consumeERC6909() external {
        // Example: Get balance
        uint256 balance = erc6909Facet.balanceOf(address(this), 1); // For token ID 1

        // Example: Approve allowance
        erc6909Facet.approve(msg.sender, 1, 100); // Approve 100 units of token ID 1

        // Example: Transfer tokens
        erc6909Facet.transfer(msg.sender, address(this), 1, 50); // Transfer 50 units of token ID 1
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the ERC6909 storage correctly during diamond deployment or upgrade. The &#x60;getStorage&#x60; function provides access to the storage slot.
- Carefully manage access control for functions like &#x60;setOperator&#x60; and &#x60;approve&#x60; to prevent unauthorized actions.
- Ensure token IDs and amounts are validated before calling transfer or approve functions.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The &#x60;transfer&#x60; and &#x60;transferFrom&#x60; functions should be carefully audited for reentrancy risks if they interact with external contracts. Ensure proper input validation for token IDs, amounts, sender, and receiver addresses to prevent unexpected behavior or exploits. Access control for &#x60;approve&#x60; and &#x60;setOperator&#x60; is critical to prevent unauthorized token management.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC6909Facet" />
</div>

<LastUpdated date="2025-12-19T21:23:07.799Z" />
