---
sidebar_position: 99
title: "ExampleDiamond"
description: "Diamond core facet for ERC-2535 implementation"
gitSource: "https://github.com/maxnorm/Compose/blob/4f58223f08f652d9b72a6792643c40cac4f0f4a0/src/diamond/example/ExampleDiamond.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
Diamond core facet for ERC-2535 implementation
</DocSubtitle>

<Callout type="info" title="Key Features">
- Manages facet registration and function selector mapping according to ERC-2535.
- Acts as the central dispatcher, delegating calls to the correct facet via `delegatecall`.
- Supports Add, Replace, and Remove actions for facets during initialization and upgrades.
</Callout>

## Overview

The ExampleDiamond contract serves as the core implementation of the ERC-2535 Diamond Standard. It manages facet registration, function selector mapping, and delegates calls to the appropriate facets, acting as the central routing mechanism for all diamond functionality.

---

## Storage

## Functions

### constructor

Struct to hold facet address and its function selectors. struct FacetCut &#123; address facetAddress; FacetCutAction action; // Add=0, Replace=1, Remove=2 bytes4[] functionSelectors; &#125; Initializes the diamond contract with facets, owner and other data. Adds all provided facets to the diamond's function selector mapping and sets the contract owner. Each facet in the array will have its function selectors registered to enable delegatecall routing.

<ExpandableCode language="solidity" maxLines={8}>
{`constructor(DiamondMod.FacetCut[] memory _facets, address _diamondOwner) ;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_facets",
      type: "DiamondMod.FacetCut[]",
      description: "Array of facet addresses and their corresponding function selectors to add to the diamond."
    },
    {
      name: "_diamondOwner",
      type: "address",
      description: "Address that will be set as the owner of the diamond contract."
    }
  ]}
  showRequired={false}
/>

---
### fallback

<ExpandableCode language="solidity" maxLines={8}>
{`fallback() external payable;`}
</ExpandableCode>

---
### receive

<ExpandableCode language="solidity" maxLines={8}>
{`receive() external payable;`}
</ExpandableCode>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {ExampleDiamond} from "@compose/contracts/src/diamond/ExampleDiamond.sol";
import {IDiamondCut} from "@compose/contracts/src/diamond/interfaces/IDiamondCut.sol";

// Assume other facets and their selectors are defined elsewhere
import {MyFacetA} from "./MyFacetA.sol";
import {MyFacetB} from "./MyFacetB.sol";

contract DeployExampleDiamond {
    address public diamondAddress;

    function deploy() public {
        // Define facet cuts for deployment
        IDiamondCut.FacetCut[] memory facetCuts = new IDiamondCut.FacetCut[](2);

        // Facet A cut
        facetCuts[0] = IDiamondCut.FacetCut({
            facetAddress: address(new MyFacetA()),
            action: IDiamondCut.FacetCutAction.Add,
            functionSelectors: MyFacetA.getSelectors()
        });

        // Facet B cut
        facetCuts[1] = IDiamondCut.FacetCut({
            facetAddress: address(new MyFacetB()),
            action: IDiamondCut.FacetCutAction.Add,
            functionSelectors: MyFacetB.getSelectors()
        });

        // Deploy the diamond, passing the initial facet cuts and owner
        ExampleDiamond deployedDiamond = new ExampleDiamond(facetCuts, msg.sender);
        diamondAddress = address(deployedDiamond);
    }

    // Example of calling a function through the diamond
    function callFacetA(address _diamondAddress) public {
        // Assume MyFacetA has a function \`doSomething()\`
        // The diamond's fallback or receive will handle routing
        // This is illustrative; actual calls use the diamond's proxy address
        (bool success, ) = _diamondAddress.call(abi.encodeWithSignature("doSomething()", MyFacetA.getSelectors()[0]));
        require(success, "Call to Facet A failed");
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the diamond with all necessary facets during deployment using the `constructor` to ensure a functional state from the outset.
- Carefully manage the `FacetCutAction` enum (Add, Replace, Remove) to control facet updates during upgrades.
- Ensure that facet addresses provided during initialization are verified and trusted to prevent malicious code injection.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
The constructor is critical for initial setup; ensure that only trusted facet addresses and selectors are provided. The `fallback` and `receive` functions are responsible for routing external calls, making them potential targets for reentrancy if not implemented carefully within the facets themselves. Input validation should be handled within individual facets, not the core diamond contract.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ExampleDiamond" />
</div>

<LastUpdated date="2025-12-19T22:47:18.787Z" />
