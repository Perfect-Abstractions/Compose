---
sidebar_position: 99
title: "ERC721Facet"
description: "ERC-721 non-fungible token facet for Compose diamonds"
gitSource: "https://github.com/maxnorm/Compose/blob/8fcbb812c7f4f59338db6b04ce17631a729a30f9/src/token/ERC721/ERC721/ERC721Facet.sol"
---

import DocSubtitle  from '@site/src/components/docs/DocSubtitle';
import Badge from '@site/src/components/ui/Badge';
import Callout from '@site/src/components/ui/Callout';
import CalloutBox from '@site/src/components/ui/CalloutBox';
import Accordion, { AccordionGroup } from '@site/src/components/ui/Accordion';
import PropertyTable from '@site/src/components/api/PropertyTable';
import ExpandableCode from '@site/src/components/code/ExpandableCode';
import CodeShowcase from '@site/src/components/code/CodeShowcase';
import RelatedDocs from '@site/src/components/docs/RelatedDocs';
import WasThisHelpful from '@site/src/components/docs/WasThisHelpful';
import LastUpdated from '@site/src/components/docs/LastUpdated';
import ReadingTime from '@site/src/components/docs/ReadingTime';
import GradientText from '@site/src/components/ui/GradientText';
import GradientButton from '@site/src/components/ui/GradientButton';

<DocSubtitle>
ERC-721 non-fungible token facet for Compose diamonds
</DocSubtitle>

<Callout type="info" title="Key Features">
- Full ERC-721 compliance, including core functions like `balanceOf`, `ownerOf`, `transferFrom`, and `approve`.
- Support for metadata retrieval via `tokenURI`.
- Includes `safeTransferFrom` variants for enhanced security during token transfers to potentially unknown recipient contracts.
- Internal `internalTransferFrom` function encapsulates core transfer logic, promoting code clarity and reuse within the facet.
</Callout>

## Overview

The ERC721Facet provides a comprehensive implementation of the ERC-721 Non-Fungible Token standard within a Compose diamond. It manages token ownership, approvals, metadata, and transfers, enabling a diamond to act as a registry and issuer of unique digital assets.

---

## Storage

### ERC721Storage

<ExpandableCode language="solidity" maxLines={15} title="Definition">
{`struct ERC721Storage {
    mapping(uint256 tokenId => address owner) ownerOf;
    mapping(address owner => uint256 balance) balanceOf;
    mapping(address owner => mapping(address operator => bool approved)) isApprovedForAll;
    mapping(uint256 tokenId => address approved) approved;
    string name;
    string symbol;
    string baseURI;
}`}
</ExpandableCode>

### State Variables

<PropertyTable
  properties={[
    {
      name: "STORAGE_POSITION",
      type: "constant",
      description: "Diamond storage slot position for this module"
    }
  ]}
  showRequired={false}
/>

## Functions

### getStorage

Returns a pointer to the ERC-721 storage struct. Uses inline assembly to access the storage slot defined by STORAGE_POSITION.

<ExpandableCode language="solidity" maxLines={8}>
{`function getStorage() internal pure returns (ERC721Storage storage s);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "s",
      type: "ERC721Storage",
      description: "The ERC721Storage struct in storage."
    }
  ]}
  showRequired={false}
/>

---
### name

Returns the token collection name.

<ExpandableCode language="solidity" maxLines={8}>
{`function name() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The name of the token collection."
    }
  ]}
  showRequired={false}
/>

---
### symbol

Returns the token collection symbol.

<ExpandableCode language="solidity" maxLines={8}>
{`function symbol() external view returns (string memory);`}
</ExpandableCode>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "The symbol of the token collection."
    }
  ]}
  showRequired={false}
/>

---
### tokenURI

Provide the metadata URI for a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function tokenURI(uint256 _tokenId) external view returns (string memory);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "tokenID of the NFT to query the metadata from"
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "string",
      description: "the URI providing the detailed metadata of the specified tokenID"
    }
  ]}
  showRequired={false}
/>

---
### balanceOf

Returns the number of tokens owned by a given address.

<ExpandableCode language="solidity" maxLines={8}>
{`function balanceOf(address _owner) external view returns (uint256);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The address to query the balance of."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "uint256",
      description: "The balance (number of tokens) owned by &#x60;_owner&#x60;."
    }
  ]}
  showRequired={false}
/>

---
### ownerOf

Returns the owner of a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function ownerOf(uint256 _tokenId) public view returns (address);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to query."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "address",
      description: "The address of the token owner."
    }
  ]}
  showRequired={false}
/>

---
### getApproved

Returns the approved address for a given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function getApproved(uint256 _tokenId) external view returns (address);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to query the approval of."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "address",
      description: "The approved address for the token."
    }
  ]}
  showRequired={false}
/>

---
### isApprovedForAll

Returns true if an operator is approved to manage all of an owner's assets.

<ExpandableCode language="solidity" maxLines={8}>
{`function isApprovedForAll(address _owner, address _operator) external view returns (bool);`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_owner",
      type: "address",
      description: "The token owner."
    },
    {
      name: "_operator",
      type: "address",
      description: "The operator address."
    }
  ]}
  showRequired={false}
/>

**Returns:**

<PropertyTable
  properties={[
    {
      name: "-",
      type: "bool",
      description: "True if the operator is approved for all tokens of the owner."
    }
  ]}
  showRequired={false}
/>

---
### approve

Approves another address to transfer the given token ID.

<ExpandableCode language="solidity" maxLines={8}>
{`function approve(address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_to",
      type: "address",
      description: "The address to be approved."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to approve."
    }
  ]}
  showRequired={false}
/>

---
### setApprovalForAll

Approves or revokes permission for an operator to manage all caller's assets.

<ExpandableCode language="solidity" maxLines={8}>
{`function setApprovalForAll(address _operator, bool _approved) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_operator",
      type: "address",
      description: "The operator address to set approval for."
    },
    {
      name: "_approved",
      type: "bool",
      description: "True to approve, false to revoke."
    }
  ]}
  showRequired={false}
/>

---
### internalTransferFrom

Internal function to transfer a token, checking for ownership and approval.

<ExpandableCode language="solidity" maxLines={8}>
{`function internalTransferFrom(address _from, address _to, uint256 _tokenId) internal;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    }
  ]}
  showRequired={false}
/>

---
### transferFrom

Transfers a token from one address to another.

<ExpandableCode language="solidity" maxLines={8}>
{`function transferFrom(address _from, address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Safely transfers a token, checking if the receiver can handle ERC-721 tokens.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _tokenId) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    }
  ]}
  showRequired={false}
/>

---
### safeTransferFrom

Safely transfers a token with additional data.

<ExpandableCode language="solidity" maxLines={8}>
{`function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes calldata _data) external;`}
</ExpandableCode>

**Parameters:**

<PropertyTable
  properties={[
    {
      name: "_from",
      type: "address",
      description: "The current owner of the token."
    },
    {
      name: "_to",
      type: "address",
      description: "The address to receive the token."
    },
    {
      name: "_tokenId",
      type: "uint256",
      description: "The token ID to transfer."
    },
    {
      name: "_data",
      type: "bytes",
      description: "Additional data with no specified format."
    }
  ]}
  showRequired={false}
/>

## Events

<AccordionGroup>
  <Accordion title="Transfer" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="Approval" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event Approval(address indexed _owner, address indexed _to, uint256 indexed _tokenId);`}
      </ExpandableCode>
    </div>

  </Accordion>
  <Accordion title="ApprovalForAll" defaultOpen={false}>

    <div style={{marginBottom: "1rem"}}>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
{`event ApprovalForAll(address indexed _owner, address indexed _operator, bool _approved);`}
      </ExpandableCode>
    </div>

  </Accordion>
</AccordionGroup>

## Errors

<AccordionGroup>
  <Accordion title="ERC721InvalidOwner" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidOwner(address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721NonexistentToken" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721NonexistentToken(uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721IncorrectOwner" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721IncorrectOwner(address _sender, uint256 _tokenId, address _owner);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidSender" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidSender(address _sender);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidReceiver" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidReceiver(address _receiver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InsufficientApproval" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InsufficientApproval(address _operator, uint256 _tokenId);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidApprover" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidApprover(address _approver);
      </ExpandableCode>
    </div>
  </Accordion>
  <Accordion title="ERC721InvalidOperator" defaultOpen={false}>

    <div>
      <strong>Signature:</strong>
      <ExpandableCode language="solidity" maxLines={5}>
error ERC721InvalidOperator(address _operator);
      </ExpandableCode>
    </div>
  </Accordion>
</AccordionGroup>

## Usage Example

<ExpandableCode language="solidity" maxLines={20} title="Example Implementation">
{`pragma solidity ^0.8.30;

import {IERC721Facet} from "@compose/contracts/src/facets/ERC721Facet.sol";

contract ERC721Consumer {
    address immutable diamondAddress;

    constructor(address _diamondAddress) {
        diamondAddress = _diamondAddress;
    }

    function consumeERC721() external {
        IERC721Facet erc721Facet = IERC721Facet(diamondAddress);

        string memory name = erc721Facet.name();
        string memory symbol = erc721Facet.symbol();
        uint256 balance = erc721Facet.balanceOf(address(this));
        // ... other ERC721 calls
    }

    function transferMyToken(address to, uint256 tokenId) external {
        IERC721Facet erc721Facet = IERC721Facet(diamondAddress);
        erc721Facet.transferFrom(msg.sender, to, tokenId);
    }
}`}
</ExpandableCode>

## Best Practices

<Callout type="tip" title="Best Practice">
- Initialize the ERC721Facet as part of the diamond deployment process, ensuring all necessary storage is correctly set up.
- When interacting with the ERC721Facet, always use the diamond's address as the target contract.
- Be mindful of gas costs associated with `safeTransferFrom` due to the on-chain checks for receiver compatibility.
</Callout>

## Security Considerations

<Callout type="warning" title="Security">
Access control for functions like `approve` and `setApprovalForAll` is implicitly handled by the ERC-721 standard, requiring ownership or prior approval. The `safeTransferFrom` functions include checks to prevent accidental token loss when transferring to contracts that do not implement the ERC721Receiver interface. Reentrancy is mitigated by the standard ERC721 transfer patterns, where checks are performed before state changes and external calls.
</Callout>

<div style={{marginTop: "3rem", paddingTop: "2rem", borderTop: "1px solid var(--ifm-color-emphasis-200)"}}>
  <WasThisHelpful pageId="ERC721Facet" />
</div>

<LastUpdated date="2025-12-20T02:03:49.076Z" />
